(function(d,b){var e={};function a(f){return b.translate(f)||f}function c(g,f){f.contents().each(function(h,j){j=d(j);if(!j.is(".plupload")){j.remove()}});f.prepend('<div class="plupload_wrapper plupload_scroll"><div id="'+g+'_container" class="plupload_container"><div class="plupload"><div class="plupload_header"><div class="plupload_header_content"><div class="plupload_header_title">'+a("Select files")+'</div><div class="plupload_header_text">'+a("Add files to the upload queue and click the start button.")+'</div></div></div><div class="plupload_content"><div class="plupload_filelist_header"><div class="plupload_file_name">'+a("Filename")+'</div><div class="plupload_file_action">&nbsp;</div><div class="plupload_file_status"><span>'+a("Status")+'</span></div><div class="plupload_file_size">'+a("Size")+'</div><div class="plupload_clearer">&nbsp;</div></div><ul id="'+g+'_filelist" class="plupload_filelist"></ul><div class="plupload_filelist_footer"><div class="plupload_file_name"><div class="plupload_buttons"><a href="#" class="plupload_button plupload_add" id="'+g+'_browse">'+a("Add Files")+'</a><a href="#" class="plupload_button plupload_start">'+a("Start Upload")+'</a></div><span class="plupload_upload_status"></span></div><div class="plupload_file_action"></div><div class="plupload_file_status"><span class="plupload_total_status">0%</span></div><div class="plupload_file_size"><span class="plupload_total_file_size">0 b</span></div><div class="plupload_progress"><div class="plupload_progress_container"><div class="plupload_progress_bar"></div></div></div><div class="plupload_clearer">&nbsp;</div></div></div></div></div><input type="hidden" id="'+g+'_count" name="'+g+'_count" value="0" /></div>')}d.fn.pluploadQueue=function(f){if(f){this.each(function(){var m,l,n,h;l=d(this);n=l.attr("id");if(!n){n=b.guid();l.attr("id",n)}h=l.html();c(n,l);f=d.extend({dragdrop:true,browse_button:n+"_browse",container:n},f);if(f.dragdrop){f.drop_element=n+"_filelist"}m=new b.Uploader(f);e[n]=m;function k(o){var q;if(o.status==b.DONE){q="plupload_done"}if(o.status==b.FAILED){q="plupload_failed"}if(o.status==b.QUEUED){q="plupload_delete"}if(o.status==b.UPLOADING){q="plupload_uploading"}var p=d("#"+o.id).attr("class",q).find("a").css("display","block");if(o.hint){p.attr("title",o.hint)}}function g(){d("span.plupload_total_status",l).html(m.total.percent+"%");d("div.plupload_progress_bar",l).css("width",m.total.percent+"%");d("span.plupload_upload_status",l).html(b.sprintf(a("Uploaded %d/%d files"),m.total.uploaded,m.files.length))}function i(){var p=d("ul.plupload_filelist",l).html(""),q=0,o;d.each(m.files,function(s,r){o="";if(r.status==b.DONE){if(r.target_name){o+='<input type="hidden" name="'+n+"_"+q+'_tmpname" value="'+b.xmlEncode(r.target_name)+'" />'}o+='<input type="hidden" name="'+n+"_"+q+'_name" value="'+b.xmlEncode(r.name)+'" />';o+='<input type="hidden" name="'+n+"_"+q+'_status" value="'+(r.status==b.DONE?"done":"failed")+'" />';q++;d("#"+n+"_count").val(q)}p.append('<li id="'+r.id+'"><div class="plupload_file_name"><span>'+r.name+'</span></div><div class="plupload_file_action"><a href="#"></a></div><div class="plupload_file_status">'+r.percent+'%</div><div class="plupload_file_size">'+b.formatSize(r.size)+'</div><div class="plupload_clearer">&nbsp;</div>'+o+"</li>");k(r);d("#"+r.id+".plupload_delete a").click(function(t){d("#"+r.id).remove();m.removeFile(r);t.preventDefault()})});d("span.plupload_total_file_size",l).html(b.formatSize(m.total.size));if(m.total.queued===0){d("span.plupload_add_text",l).html(a("Add Files"))}else{d("span.plupload_add_text",l).html(b.sprintf(a("%d files queued"),m.total.queued))}d("a.plupload_start",l).toggleClass("plupload_disabled",m.files.length==m.total.uploaded+m.total.failed);p[0].scrollTop=p[0].scrollHeight;g();if(!m.files.length&&m.features.dragdrop&&m.settings.dragdrop){d("#"+n+"_filelist").append('<li class="plupload_droptext">'+a("Drag files here.")+"</li>")}}function j(){delete e[n];m.destroy();l.html(h);m=l=h=null}m.bind("UploadFile",function(o,p){d("#"+p.id).addClass("plupload_current_file")});m.bind("Init",function(o,p){if(!f.unique_names&&f.rename){l.on("click","#"+n+"_filelist div.plupload_file_name span",function(v){var t=d(v.target),r,u,q,s="";r=o.getFile(t.parents("li")[0].id);q=r.name;u=/^(.+)(\.[^.]+)$/.exec(q);if(u){q=u[1];s=u[2]}t.hide().after('<input type="text" />');t.next().val(q).focus().blur(function(){t.show().next().remove()}).keydown(function(x){var w=d(this);if(x.keyCode==13){x.preventDefault();r.name=w.val()+s;t.html(r.name);w.blur()}})})}d("#"+n+"_container").attr("title","Using runtime: "+p.runtime);d("a.plupload_start",l).click(function(q){if(!d(this).hasClass("plupload_disabled")){m.start()}q.preventDefault()});d("a.plupload_stop",l).click(function(q){q.preventDefault();m.stop()});d("a.plupload_start",l).addClass("plupload_disabled")});m.bind("Error",function(o,r){var p=r.file,q;if(p){q=r.message;if(r.details){q+=" ("+r.details+")"}if(r.code==b.FILE_SIZE_ERROR){alert(a("Error: File too large:")+" "+p.name)}if(r.code==b.FILE_EXTENSION_ERROR){alert(a("Error: Invalid file extension:")+" "+p.name)}p.hint=q;d("#"+p.id).attr("class","plupload_failed").find("a").css("display","block").attr("title",q)}if(r.code===b.INIT_ERROR){setTimeout(function(){j()},1)}});m.bind("PostInit",function(o){if(o.settings.dragdrop&&o.features.dragdrop){d("#"+n+"_filelist").append('<li class="plupload_droptext">'+a("Drag files here.")+"</li>")}});m.init();m.bind("StateChanged",function(){if(m.state===b.STARTED){d("li.plupload_delete a,div.plupload_buttons",l).hide();m.disableBrowse(true);d("span.plupload_upload_status,div.plupload_progress,a.plupload_stop",l).css("display","block");d("span.plupload_upload_status",l).html("Uploaded "+m.total.uploaded+"/"+m.files.length+" files");if(f.multiple_queues){d("span.plupload_total_status,span.plupload_total_file_size",l).show()}}else{i();d("a.plupload_stop,div.plupload_progress",l).hide();d("a.plupload_delete",l).css("display","block");if(f.multiple_queues&&m.total.uploaded+m.total.failed==m.files.length){d(".plupload_buttons,.plupload_upload_status",l).css("display","inline");m.disableBrowse(false);d(".plupload_start",l).addClass("plupload_disabled");d("span.plupload_total_status,span.plupload_total_file_size",l).hide()}}});m.bind("FilesAdded",i);m.bind("FilesRemoved",function(){var o=d("#"+n+"_filelist").scrollTop();i();d("#"+n+"_filelist").scrollTop(o)});m.bind("FileUploaded",function(o,p){k(p)});m.bind("UploadProgress",function(o,p){d("#"+p.id+" div.plupload_file_status",l).html(p.percent+"%");k(p);g()});if(f.setup){f.setup(m)}});return this}else{return e[d(this[0]).attr("id")]}}})(jQuery,plupload);