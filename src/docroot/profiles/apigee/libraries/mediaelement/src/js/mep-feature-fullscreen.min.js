(function($){$.extend(mejs.MepDefaults,{usePluginFullScreen:true,newWindowCallback:function(){return""},fullscreenText:""});$.extend(MediaElementPlayer.prototype,{isFullScreen:false,isNativeFullScreen:false,isInIframe:false,fullscreenMode:"",buildfullscreen:function(player,controls,layers,media){if(!player.isVideo)return;player.isInIframe=window.location!=window.parent.location;media.addEventListener("loadstart",function(){player.detectFullscreenMode()});var t=this,hideTimeout=null,fullscreenTitle=t.options.fullscreenText?t.options.fullscreenText:mejs.i18n.t("mejs.fullscreen"),fullscreenBtn=$('<div class="mejs-button mejs-fullscreen-button">'+'<button type="button" aria-controls="'+t.id+'" title="'+fullscreenTitle+'" aria-label="'+fullscreenTitle+'"></button>'+"</div>").appendTo(controls).on("click",function(){var isFullScreen=mejs.MediaFeatures.hasTrueNativeFullScreen&&mejs.MediaFeatures.isFullScreen()||player.isFullScreen;if(isFullScreen){player.exitFullScreen()}else{player.enterFullScreen()}}).on("mouseover",function(){if(t.fullscreenMode=="plugin-hover"){if(hideTimeout!==null){clearTimeout(hideTimeout);delete hideTimeout}var buttonPos=fullscreenBtn.offset(),containerPos=player.container.offset();media.positionFullscreenButton(buttonPos.left-containerPos.left,buttonPos.top-containerPos.top,true)}}).on("mouseout",function(){if(t.fullscreenMode=="plugin-hover"){if(hideTimeout!==null){clearTimeout(hideTimeout);delete hideTimeout}hideTimeout=setTimeout(function(){media.hideFullscreenButton()},1500)}});player.fullscreenBtn=fullscreenBtn;t.globalBind("keydown",function(e){if(e.keyCode==27&&(mejs.MediaFeatures.hasTrueNativeFullScreen&&mejs.MediaFeatures.isFullScreen()||t.isFullScreen)){player.exitFullScreen()}});t.normalHeight=0;t.normalWidth=0;if(mejs.MediaFeatures.hasTrueNativeFullScreen){var fullscreenChanged=function(e){if(player.isFullScreen){if(mejs.MediaFeatures.isFullScreen()){player.isNativeFullScreen=true;player.setControlsSize()}else{player.isNativeFullScreen=false;player.exitFullScreen()}}};player.globalBind(mejs.MediaFeatures.fullScreenEventName,fullscreenChanged)}},detectFullscreenMode:function(){var t=this,mode="",features=mejs.MediaFeatures;if(features.hasTrueNativeFullScreen&&t.media.pluginType==="native"){mode="native-native"}else if(features.hasTrueNativeFullScreen&&t.media.pluginType!=="native"&&!features.hasFirefoxPluginMovingProblem){mode="plugin-native"}else if(t.usePluginFullScreen){if(mejs.MediaFeatures.supportsPointerEvents){mode="plugin-click";t.createPluginClickThrough()}else{mode="plugin-hover"}}else{mode="fullwindow"}t.fullscreenMode=mode;return mode},isPluginClickThroughCreated:false,createPluginClickThrough:function(){var t=this;if(t.isPluginClickThroughCreated){return}var fullscreenIsDisabled=false,restoreControls=function(){if(fullscreenIsDisabled){for(var i in hoverDivs){hoverDivs[i].hide()}t.fullscreenBtn.css("pointer-events","");t.controls.css("pointer-events","");t.media.removeEventListener("click",t.clickToPlayPauseCallback);fullscreenIsDisabled=false}},hoverDivs={},hoverDivNames=["top","left","right","bottom"],i,len,positionHoverDivs=function(){var fullScreenBtnOffsetLeft=fullscreenBtn.offset().left-t.container.offset().left,fullScreenBtnOffsetTop=fullscreenBtn.offset().top-t.container.offset().top,fullScreenBtnWidth=fullscreenBtn.outerWidth(true),fullScreenBtnHeight=fullscreenBtn.outerHeight(true),containerWidth=t.container.width(),containerHeight=t.container.height();for(i in hoverDivs){hoverDivs[i].css({position:"absolute",top:0,left:0})}hoverDivs["top"].width(containerWidth).height(fullScreenBtnOffsetTop);hoverDivs["left"].width(fullScreenBtnOffsetLeft).height(fullScreenBtnHeight).css({top:fullScreenBtnOffsetTop});hoverDivs["right"].width(containerWidth-fullScreenBtnOffsetLeft-fullScreenBtnWidth).height(fullScreenBtnHeight).css({top:fullScreenBtnOffsetTop,left:fullScreenBtnOffsetLeft+fullScreenBtnWidth});hoverDivs["bottom"].width(containerWidth).height(containerHeight-fullScreenBtnHeight-fullScreenBtnOffsetTop).css({top:fullScreenBtnOffsetTop+fullScreenBtnHeight})};t.globalBind("resize",function(){positionHoverDivs()});for(i=0,len=hoverDivNames.length;i<len;i++){hoverDivs[hoverDivNames[i]]=$('<div class="mejs-fullscreen-hover" />').appendTo(t.container).mouseover(restoreControls).hide()}fullscreenBtn.on("mouseover",function(){if(!t.isFullScreen){var buttonPos=fullscreenBtn.offset(),containerPos=player.container.offset();media.positionFullscreenButton(buttonPos.left-containerPos.left,buttonPos.top-containerPos.top,false);t.fullscreenBtn.css("pointer-events","none");t.controls.css("pointer-events","none");t.media.addEventListener("click",t.clickToPlayPauseCallback);for(i in hoverDivs){hoverDivs[i].show()}positionHoverDivs();fullscreenIsDisabled=true}});media.addEventListener("fullscreenchange",function(e){t.isFullScreen=!t.isFullScreen;if(t.isFullScreen){t.media.removeEventListener("click",t.clickToPlayPauseCallback)}else{t.media.addEventListener("click",t.clickToPlayPauseCallback)}restoreControls()});t.globalBind("mousemove",function(e){if(fullscreenIsDisabled){var fullscreenBtnPos=fullscreenBtn.offset();if(e.pageY<fullscreenBtnPos.top||e.pageY>fullscreenBtnPos.top+fullscreenBtn.outerHeight(true)||e.pageX<fullscreenBtnPos.left||e.pageX>fullscreenBtnPos.left+fullscreenBtn.outerWidth(true)){fullscreenBtn.css("pointer-events","");t.controls.css("pointer-events","");fullscreenIsDisabled=false}}});t.isPluginClickThroughCreated=true},cleanfullscreen:function(player){player.exitFullScreen()},containerSizeTimeout:null,enterFullScreen:function(){var t=this;if(mejs.MediaFeatures.isiOS&&mejs.MediaFeatures.hasiOSFullScreen&&typeof t.media.webkitEnterFullscreen==="function"){t.media.webkitEnterFullscreen();return}$(document.documentElement).addClass("mejs-fullscreen");t.normalHeight=t.container.height();t.normalWidth=t.container.width();if(t.fullscreenMode==="native-native"||t.fullscreenMode==="plugin-native"){mejs.MediaFeatures.requestFullScreen(t.container[0]);if(t.isInIframe){setTimeout(function checkFullscreen(){if(t.isNativeFullScreen){var percentErrorMargin=.002,windowWidth=$(window).width(),screenWidth=screen.width,absDiff=Math.abs(screenWidth-windowWidth),marginError=screenWidth*percentErrorMargin;if(absDiff>marginError){t.exitFullScreen()}else{setTimeout(checkFullscreen,500)}}},1e3)}}else if(t.fullscreeMode=="fullwindow"){}t.container.addClass("mejs-container-fullscreen").width("100%").height("100%");t.containerSizeTimeout=setTimeout(function(){t.container.css({width:"100%",height:"100%"});t.setControlsSize()},500);if(t.media.pluginType==="native"){t.$media.width("100%").height("100%")}else{t.container.find(".mejs-shim").width("100%").height("100%");setTimeout(function(){var win=$(window),winW=win.width(),winH=win.height();t.media.setVideoSize(winW,winH)},500)}t.layers.children("div").width("100%").height("100%");if(t.fullscreenBtn){t.fullscreenBtn.removeClass("mejs-fullscreen").addClass("mejs-unfullscreen")}t.setControlsSize();t.isFullScreen=true;var zoomFactor=Math.min(screen.width/t.width,screen.height/t.height);t.container.find(".mejs-captions-text").css("font-size",zoomFactor*100+"%");t.container.find(".mejs-captions-text").css("line-height","normal");t.container.find(".mejs-captions-position").css("bottom","45px");t.container.trigger("enteredfullscreen")},exitFullScreen:function(){var t=this;clearTimeout(t.containerSizeTimeout);if(mejs.MediaFeatures.hasTrueNativeFullScreen&&(mejs.MediaFeatures.isFullScreen()||t.isFullScreen)){mejs.MediaFeatures.cancelFullScreen()}$(document.documentElement).removeClass("mejs-fullscreen");t.container.removeClass("mejs-container-fullscreen").width(t.normalWidth).height(t.normalHeight);if(t.media.pluginType==="native"){t.$media.width(t.normalWidth).height(t.normalHeight)}else{t.container.find(".mejs-shim").width(t.normalWidth).height(t.normalHeight);t.media.setVideoSize(t.normalWidth,t.normalHeight)}t.layers.children("div").width(t.normalWidth).height(t.normalHeight);t.fullscreenBtn.removeClass("mejs-unfullscreen").addClass("mejs-fullscreen");t.setControlsSize();t.isFullScreen=false;t.container.find(".mejs-captions-text").css("font-size","");t.container.find(".mejs-captions-text").css("line-height","");t.container.find(".mejs-captions-position").css("bottom","");t.container.trigger("exitedfullscreen")}})})(mejs.$);