(function($){$("head").append($("<style>"+".mejs-ads a {"+"\tdisplay: block; "+"\tposition: absolute;"+"\tright: 0;"+"\ttop: 0;"+"\twidth: 100%; "+"\theight: 100%; "+"\tdisplay: block; "+"}"+".mejs-ads .mejs-ads-skip-block {"+"\tdisplay: block; "+"\tposition: absolute;"+"\tright: 0;"+"\ttop: 0;"+"\tpadding: 10px; "+"\tbackground: #000; "+"\tbackground: rgba(0,0,0,0.5); "+"\tcolor: #fff; "+"}"+".mejs-ads .mejs-ads-skip-button {"+"\tcursor: pointer; "+"}"+".mejs-ads .mejs-ads-skip-button:hover {"+"\ttext-decoration: underline; "+"}"+"</style>"));$.extend(mejs.MepDefaults,{adsPrerollMediaUrl:[],adsPrerollAdUrl:[],adsPrerollAdEnableSkip:false,adsPrerollAdSkipSeconds:-1,indexPreroll:0});$.extend(MediaElementPlayer.prototype,{adsLoaded:false,adsDataIsLoading:false,adsCurrentMediaUrl:"",adsCurrentMediaDuration:0,adsPlayerHasStarted:false,buildads:function(player,controls,layers,media){var t=this;if(t.adsLoaded){return}else{t.adsLoaded=true}player.adsLayer=$('<div class="mejs-layer mejs-overlay mejs-ads">'+'<a href="#" target="_blank">&nbsp;</a>'+'<div class="mejs-ads-skip-block">'+'<span class="mejs-ads-skip-message"></span>'+'<span class="mejs-ads-skip-button">'+mejs.i18n.t("mejs.ad-skip")+"&raquo;</span>"+"</div>"+"</div>").insertBefore(layers.find(".mejs-overlay-play")).hide();player.adsLayer.find("a").on("click",$.proxy(t.adsAdClick,t));player.adsSkipBlock=player.adsLayer.find(".mejs-ads-skip-block").hide();player.adsSkipMessage=player.adsLayer.find(".mejs-ads-skip-message").hide();player.adsSkipButton=player.adsLayer.find(".mejs-ads-skip-button").on("click",$.proxy(t.adsSkipClick,t));t.adsMediaTryingToStartProxy=$.proxy(t.adsMediaTryingToStart,t);t.adsPrerollStartedProxy=$.proxy(t.adsPrerollStarted,t);t.adsPrerollMetaProxy=$.proxy(t.adsPrerollMeta,t);t.adsPrerollUpdateProxy=$.proxy(t.adsPrerollUpdate,t);t.adsPrerollEndedProxy=$.proxy(t.adsPrerollEnded,t);t.media.addEventListener("play",t.adsMediaTryingToStartProxy);t.media.addEventListener("playing",t.adsMediaTryingToStartProxy);t.media.addEventListener("canplay",t.adsMediaTryingToStartProxy);t.media.addEventListener("loadedmetadata",t.adsMediaTryingToStartProxy);console.log("setup ads",t.options.adsPrerollMediaUrl[t.options.indexPreroll]);if(t.options.indexPreroll<t.options.adsPrerollMediaUrl.length){t.adsStartPreroll()}},adsMediaTryingToStart:function(){var t=this;if(t.adsDataIsLoading&&!t.media.paused){t.media.pause()}t.adsPlayerHasStarted=true},adsStartPreroll:function(){var t=this;console.log("adsStartPreroll","url",t.options.adsPrerollMediaUrl[t.options.indexPreroll]);t.media.addEventListener("loadedmetadata",t.adsPrerollMetaProxy);t.media.addEventListener("playing",t.adsPrerollStartedProxy);t.media.addEventListener("ended",t.adsPrerollEndedProxy);t.media.addEventListener("timeupdate",t.adsPrerollUpdateProxy);if(t.options.indexPreroll==0){t.adsCurrentMediaUrl=t.media.src;t.adsCurrentMediaDuration=t.media.duration}t.media.setSrc(t.options.adsPrerollMediaUrl[t.options.indexPreroll]);t.media.load();if(t.adsPlayerHasStarted){t.media.play()}},adsPrerollMeta:function(){var t=this,newDuration=0;console.log("loadedmetadata",t.media.duration,t.adsCurrentMediaDuration);if(t.options.duration>0){newDuration=t.options.duration}else if(!isNaN(t.adsCurrentMediaDuration)){newDuration=t.adsCurrentMediaDuration}setTimeout(function(){t.controls.find(".mejs-duration").html(mejs.Utility.secondsToTimeCode(newDuration,t.options))},250)},adsPrerollStarted:function(){console.log("adsPrerollStarted");var t=this;t.media.removeEventListener("playing",t.adsPrerollStartedProxy);t.disableControls();t.adsLayer.show();if(t.options.adsPrerollAdUrl[t.options.indexPreroll]!=""){t.adsLayer.find("a").attr("href",t.options.adsPrerollAdUrl[t.options.indexPreroll])}else{t.adsLayer.find("a").attr("href","#");t.adsLayer.find("a").attr("target","")}if(t.options.adsPrerollAdEnableSkip){t.adsSkipBlock.show();if(t.options.adsPrerollAdSkipSeconds>0){t.adsSkipMessage.html(mejs.i18n.t("mejs.ad-skip-info").replace("%1",t.options.adsPrerollAdSkipSeconds.toString())).show();t.adsSkipButton.hide()}else{t.adsSkipMessage.hide();t.adsSkipButton.show()}}else{t.adsSkipBlock.hide()}t.container.trigger("mejsprerollstarted")},adsPrerollUpdate:function(){var t=this;if(t.options.adsPrerollAdEnableSkip&&t.options.adsPrerollAdSkipSeconds>0){if(t.media.currentTime>t.options.adsPrerollAdSkipSeconds){t.adsSkipButton.show();t.adsSkipMessage.hide()}else{t.adsSkipMessage.html(mejs.i18n.t("mejs.ad-skip-info").replace("%1",Math.round(t.options.adsPrerollAdSkipSeconds-t.media.currentTime).toString()))}}t.container.trigger("mejsprerolltimeupdate")},adsPrerollEnded:function(){console.log("adsPrerollEnded");var t=this;t.container.trigger("mejsprerollended");t.options.indexPreroll++;if(t.options.indexPreroll<t.options.adsPrerollMediaUrl.length)t.adsStartPreroll();else t.adRestoreMainMedia()},adRestoreMainMedia:function(){console.log("adRestoreMainMedia",this.adsCurrentMediaUrl);var t=this;t.media.setSrc(t.adsCurrentMediaUrl);setTimeout(function(){t.media.load();t.media.play()},10);t.enableControls();t.adsLayer.hide();t.media.removeEventListener("ended",t.adsPrerollEndedProxy);t.media.removeEventListener("loadedmetadata",t.adsPrerollMetaProxy);t.media.removeEventListener("timeupdate",t.adsPrerollUpdateProxy);t.container.trigger("mejsprerollmainstarted")},adsAdClick:function(e){console.log("adsAdClicked");var t=this;if(t.media.paused){t.media.play()}else{t.media.pause()}t.container.trigger("mejsprerolladsclicked")},adsSkipClick:function(){console.log("adsSkipClick");var t=this;t.container.trigger("mejsprerollskipclicked");t.container.trigger("mejsprerollended");t.options.indexPreroll++;if(t.options.indexPreroll<t.options.adsPrerollMediaUrl.length)t.adsStartPreroll();else t.adRestoreMainMedia()},prerollAdsFinished:function(){var t=this;if(t.options.indexPreroll==t.options.adsPrerollMediaUrl.length)return true;else return false},adsLoadUrl:function(url){console.log("adsLoadUrl",url);var img=new Image,rnd=Math.round(Math.random()*1e5);img.src=url+(url.indexOf("?")>0?"&":"?")+"random"+rnd+"="+rnd;img.loaded=function(){img=null}}})})(mejs.$);