CKEDITOR.plugins.add("insertpre",{requires:"dialog",lang:"en,pl",icons:"insertpre",onLoad:function(){if(CKEDITOR.config.insertpre_class){CKEDITOR.addCss("pre."+CKEDITOR.config.insertpre_class+" {"+CKEDITOR.config.insertpre_style+"}")}},init:function(a){var b=CKEDITOR.config.insertpre_class?"pre( "+CKEDITOR.config.insertpre_class+" )":"pre";a.addCommand("insertpre",new CKEDITOR.dialogCommand("insertpre",{allowedContent:b,requiredContent:b}));a.ui.addButton&&a.ui.addButton("InsertPre",{label:a.lang.insertpre.title,icon:this.path+"icons/insertpre.png",command:"insertpre",toolbar:"insert,99"});if(a.contextMenu){a.addMenuGroup("code");a.addMenuItem("insertpre",{label:a.lang.insertpre.edit,icon:this.path+"icons/insertpre.png",command:"insertpre",group:"code"});a.contextMenu.addListener(function(c){if(c){c=c.getAscendant("pre",true)}if(c&&!c.isReadOnly()&&c.hasClass(a.config.insertpre_class)){return{insertpre:CKEDITOR.TRISTATE_OFF}}return null})}CKEDITOR.dialog.add("insertpre",function(c){return{title:c.lang.insertpre.title,minWidth:540,minHeight:380,contents:[{id:"general",label:c.lang.insertpre.code,elements:[{type:"textarea",id:"contents",label:c.lang.insertpre.code,cols:140,rows:22,validate:CKEDITOR.dialog.validate.notEmpty(c.lang.insertpre.notEmpty),required:true,setup:function(e){var d=e.getHtml();if(d){var f=document.createElement("div");f.innerHTML=d;this.setValue(f.firstChild.nodeValue)}},commit:function(d){d.setHtml(CKEDITOR.tools.htmlEncode(this.getValue()))}}]}],onShow:function(){var e=c.getSelection(),d=e.getStartElement();if(d){d=d.getAscendant("pre",true)}if(!d||d.getName()!="pre"||!d.hasClass(c.config.insertpre_class)){d=c.document.createElement("pre");this.insertMode=true}else{this.insertMode=false}this.pre=d;this.setupContent(this.pre)},onOk:function(){if(c.config.insertpre_class){this.pre.setAttribute("class",c.config.insertpre_class)}if(this.insertMode){c.insertElement(this.pre)}this.commitContent(this.pre)}}})}});if(typeof CKEDITOR.config.insertpre_style=="undefined"){CKEDITOR.config.insertpre_style="background-color:#F8F8F8;border:1px solid #DDD;padding:10px;"}if(typeof CKEDITOR.config.insertpre_class=="undefined"){CKEDITOR.config.insertpre_class="prettyprint"}