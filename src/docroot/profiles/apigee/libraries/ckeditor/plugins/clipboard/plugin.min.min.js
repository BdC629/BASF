"use strict";(function(){CKEDITOR.plugins.add("clipboard",{requires:"dialog",lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en,en-au,en-ca,en-gb,eo,es,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,ug,uk,vi,zh,zh-cn",icons:"copy,copy-rtl,cut,cut-rtl,paste,paste-rtl",hidpi:true,init:function(h){var g;d(h);CKEDITOR.dialog.add("paste",CKEDITOR.getUrl(this.path+"dialogs/paste.js"));h.on("paste",function(i){var m=i.data.dataValue,k=CKEDITOR.dtd.$block;if(m.indexOf("Apple-")>-1){m=m.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," ");if(i.data.type!="html"){m=m.replace(/<span class="Apple-tab-span"[^>]*>([^<]*)<\/span>/gi,function(p,o){return o.replace(/\t/g,"&nbsp;&nbsp; &nbsp;")})}if(m.indexOf('<br class="Apple-interchange-newline">')>-1){i.data.startsWithEOL=1;i.data.preSniffing="html";m=m.replace(/<br class="Apple-interchange-newline">/,"")}m=m.replace(/(<[^>]+) class="Apple-[^"]*"/gi,"$1")}if(m.match(/^<[^<]+cke_(editable|contents)/i)){var j,l,n=new CKEDITOR.dom.element("div");n.setHtml(m);while(n.getChildCount()==1&&(j=n.getFirst())&&j.type==CKEDITOR.NODE_ELEMENT&&(j.hasClass("cke_editable")||j.hasClass("cke_contents"))){n=l=j}if(l){m=l.getHtml().replace(/<br>$/i,"")}}if(CKEDITOR.env.ie){m=m.replace(/^&nbsp;(?: |\r\n)?<(\w+)/g,function(p,o){if(o.toLowerCase()in k){i.data.preSniffing="html";return"<"+o}return p})}else{if(CKEDITOR.env.webkit){m=m.replace(/<\/(\w+)><div><br><\/div>$/,function(p,o){if(o in k){i.data.endsWithEOL=1;return"</"+o+">"}return p})}else{if(CKEDITOR.env.gecko){m=m.replace(/(\s)<br>$/,"$1")}}}i.data.dataValue=m},null,null,3);h.on("paste",function(j){var k=j.data,l=k.type,m=k.dataValue,i,n=h.config.clipboard_defaultContentType||"html";if(l=="html"||k.preSniffing=="html"){i="html"}else{i=f(m)}if(i=="htmlifiedtext"){m=a(h.config,m)}else{if(l=="text"&&i=="html"){m=c(h.config,m,g||(g=e(h)))}}if(k.startsWithEOL){m='<br data-cke-eol="1">'+m}if(k.endsWithEOL){m+='<br data-cke-eol="1">'}if(l=="auto"){l=i=="html"||n=="html"?"html":"text"}k.type=l;k.dataValue=m;delete k.preSniffing;delete k.startsWithEOL;delete k.endsWithEOL},null,null,6);h.on("paste",function(i){var j=i.data;h.insertHtml(j.dataValue,j.type);setTimeout(function(){h.fire("afterPaste")},0)},null,null,1e3);h.on("pasteDialog",function(i){setTimeout(function(){h.openDialog("paste",i.data)},0)})}});function d(l){var h=0,z=0,u=0,k=CKEDITOR.env.ie?"beforepaste":"paste";t();i();l.getClipboardData=function(J,H){var C=false,E="auto",G=false;if(!H){H=J;J=null}l.on("paste",I,null,null,0);l.on("beforePaste",D,null,null,1e3);if(v()===false){l.removeListener("paste",I);if(C&&l.fire("pasteDialog",F)){l.on("pasteDialogCommit",B);l.on("dialogHide",function(K){K.removeListener();K.data.removeListener("pasteDialogCommit",B);setTimeout(function(){if(!G){H(null)}},10)})}else{H(null)}}function I(K){K.removeListener();K.cancel();H(K.data)}function D(K){K.removeListener();C=true;E=K.data.type}function B(K){K.removeListener();K.cancel();G=true;H({type:E,dataValue:K.data})}function F(){this.customTitle=J&&J.title}};function i(){B("Cut","cut",x("cut"),10,1);B("Copy","copy",x("copy"),20,4);B("Paste","paste",q(),30,8);function B(C,E,H,F,D){var G=l.lang.clipboard[E];l.addCommand(E,H);l.ui.addButton&&l.ui.addButton(C,{label:G,command:E,toolbar:"clipboard,"+F});if(l.addMenuItems){l.addMenuItem(E,{label:G,command:E,group:"clipboard",order:D})}}}function t(){l.on("key",j);l.on("contentDom",g);l.on("selectionChange",function(B){u=B.data.selection.getRanges()[0].checkReadOnly();s()});if(l.contextMenu){l.contextMenu.addListener(function(B,C){u=C.getRanges()[0].checkReadOnly();return{cut:w("cut"),copy:w("copy"),paste:w("paste")}})}}function g(){var B=l.editable();B.on(k,function(D){if(CKEDITOR.env.ie&&h){return}n(D)});CKEDITOR.env.ie&&B.on("paste",function(D){if(z){return}A();D.data.preventDefault();n(D);if(!y("paste")){l.openDialog("paste")}});if(CKEDITOR.env.ie){B.on("contextmenu",o,null,null,0);B.on("beforepaste",function(D){if(D.data&&!D.data.$.ctrlKey){o()}},null,null,0)}B.on("beforecut",function(){!h&&p(l)});var C;B.attachListener(CKEDITOR.env.ie?B:l.document.getDocumentElement(),"mouseup",function(){C=setTimeout(function(){s()},0)});l.on("destroy",function(){clearTimeout(C)});B.on("keyup",s)}function x(B){return{type:B,canUndo:B=="cut",startDisabled:true,exec:function(D){function C(F){if(CKEDITOR.env.ie){return y(F)}try{return l.document.$.execCommand(F,false,null)}catch(G){return false}}this.type=="cut"&&p();var E=C(this.type);if(!E){alert(l.lang.clipboard[this.type+"Error"])}return E}}}function q(){return{canUndo:false,async:true,exec:function(C,E){var B=function(G,F){G&&m(G.type,G.dataValue,!!F);C.fire("afterCommandExec",{name:"paste",command:D,returnValue:!!G})},D=this;if(typeof E=="string"){B({type:"auto",dataValue:E},1)}else{C.getClipboardData(B)}}}}function A(){z=1;setTimeout(function(){z=0},100)}function o(){h=1;setTimeout(function(){h=0},10)}function y(E){var D=l.document,B=D.getBody(),C=false,F=function(){C=true};B.on(E,F);(CKEDITOR.env.version>7?D.$:D.$.selection.createRange())["execCommand"](E);B.removeListener(E,F);return C}function m(C,E,B){var D={type:C};if(B){if(!l.fire("beforePaste",D)){return false}}if(!E){return false}D.dataValue=E;return l.fire("paste",D)}function p(){if(!CKEDITOR.env.ie||CKEDITOR.env.quirks){return}var C=l.getSelection(),E,B,D;if(C.getType()==CKEDITOR.SELECTION_ELEMENT&&(E=C.getSelectedElement())){B=C.getRanges()[0];D=l.document.createText("");D.insertBefore(E);B.setStartBefore(D);B.setEndAfter(E);C.selectRanges([B]);setTimeout(function(){if(E.getParent()){D.remove();C.selectElement(E)}},0)}}function r(O,P){var M=l.document,E=l.editable(),Q=function(S){S.cancel()},L=CKEDITOR.env.gecko&&CKEDITOR.env.version<=10902,N;if(M.getById("cke_pastebin")){return}var D=l.getSelection();var H=D.createBookmarks();var G=new CKEDITOR.dom.element((CKEDITOR.env.webkit||E.is("body"))&&!(CKEDITOR.env.ie||CKEDITOR.env.opera)?"body":"div",M);G.setAttributes({id:"cke_pastebin","data-cke-temp":"1"});if(CKEDITOR.env.opera){G.appendBogus()}var J=0,B,K=M.getWindow();if(L){G.insertAfter(H[0].startNode);G.setStyle("display","inline")}else{if(CKEDITOR.env.webkit){E.append(G);G.addClass("cke_editable");if(!E.is("body")){if(E.getComputedStyle("position")!="static"){B=E}else{B=CKEDITOR.dom.element.get(E.$.offsetParent)}J=B.getDocumentPosition().y}}else{E.getAscendant(CKEDITOR.env.ie||CKEDITOR.env.opera?"body":"html",1).append(G)}G.setStyles({position:"absolute",top:K.getScrollPosition().y-J+10+"px",width:"1px",height:Math.max(1,K.getViewPaneSize().height-20)+"px",overflow:"hidden",margin:0,padding:0})}var R=G.getParent().isReadOnly();if(R){G.setOpacity(0);G.setAttribute("contenteditable",true)}else{G.setStyle(l.config.contentsLangDirection=="ltr"?"left":"right","-1000px")}l.on("selectionChange",Q,null,null,0);if(CKEDITOR.env.webkit||CKEDITOR.env.gecko){N=E.once("blur",Q,null,null,-100)}R&&G.focus();var I=new CKEDITOR.dom.range(G);I.selectNodeContents(G);var F=I.select();if(CKEDITOR.env.ie){N=E.once("blur",function(S){l.lockSelection(F)})}var C=CKEDITOR.document.getWindow().getScrollPosition().y;setTimeout(function(){if(CKEDITOR.env.webkit||CKEDITOR.env.opera){CKEDITOR.document[CKEDITOR.env.webkit?"getBody":"getDocumentElement"]().$.scrollTop=C}N&&N.removeListener();if(CKEDITOR.env.ie){E.focus()}D.selectBookmarks(H);G.remove();var S;if(CKEDITOR.env.webkit&&(S=G.getFirst())&&(S.is&&S.hasClass("Apple-style-span"))){G=S}l.removeListener("selectionChange",Q);P(G.getHtml())},0)}function v(){if(CKEDITOR.env.ie){l.focus();A();var B=l.focusManager;B.lock();if(l.editable().fire(k)&&!y("paste")){B.unlock();return false}B.unlock()}else{try{if(l.editable().fire(k)&&!l.document.$.execCommand("Paste",false,null)){throw 0}}catch(C){return false}}return true}function j(C){if(l.mode!="wysiwyg"){return}switch(C.data.keyCode){case CKEDITOR.CTRL+86:case CKEDITOR.SHIFT+45:var B=l.editable();A();!CKEDITOR.env.ie&&B.fire("beforepaste");if(CKEDITOR.env.opera||CKEDITOR.env.gecko&&CKEDITOR.env.version<10900){B.fire("paste")}return;case CKEDITOR.CTRL+88:case CKEDITOR.SHIFT+46:l.fire("saveSnapshot");setTimeout(function(){l.fire("saveSnapshot")},50)}}function n(B){var D={type:"auto"};var C=l.fire("beforePaste",D);r(B,function(E){E=E.replace(/<span[^>]+data-cke-bookmark[^<]*?<\/span>/gi,"");C&&m(D.type,E,0,1)})}function s(){if(l.mode!="wysiwyg"){return}var B=w("paste");l.getCommand("cut").setState(w("cut"));l.getCommand("copy").setState(w("copy"));l.getCommand("paste").setState(B);l.fire("pasteState",B)}function w(E){if(u&&E in{paste:1,cut:1}){return CKEDITOR.TRISTATE_DISABLED}if(E=="paste"){return CKEDITOR.TRISTATE_OFF}var C=l.getSelection(),B=C.getRanges(),D=C.getType()==CKEDITOR.SELECTION_NONE||B.length==1&&B[0].collapsed;return D?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_OFF}}function f(g){if(CKEDITOR.env.webkit){if(!g.match(/^[^<]*$/g)&&!g.match(/^(<div><br( ?\/)?><\/div>|<div>[^<]*<\/div>)*$/gi)){return"html"}}else{if(CKEDITOR.env.ie){if(!g.match(/^([^<]|<br( ?\/)?>)*$/gi)&&!g.match(/^(<p>([^<]|<br( ?\/)?>)*<\/p>|(\r\n))*$/gi)){return"html"}}else{if(CKEDITOR.env.gecko||CKEDITOR.env.opera){if(!g.match(/^([^<]|<br( ?\/)?>)*$/gi)){return"html"}}else{return"html"}}}return"htmlifiedtext"}function a(h,i){function g(j){return CKEDITOR.tools.repeat("</p><p>",~~(j/2))+(j%2==1?"<br>":"")}i=i.replace(/\s+/g," ").replace(/> +</g,"><").replace(/<br ?\/>/gi,"<br>");i=i.replace(/<\/?[A-Z]+>/g,function(j){return j.toLowerCase()});if(i.match(/^[^<]$/)){return i}if(CKEDITOR.env.webkit&&i.indexOf("<div>")>-1){i=i.replace(/^(<div>(<br>|)<\/div>)(?!$|(<div>(<br>|)<\/div>))/g,"<br>").replace(/^(<div>(<br>|)<\/div>){2}(?!$)/g,"<div></div>");if(i.match(/<div>(<br>|)<\/div>/)){i="<p>"+i.replace(/(<div>(<br>|)<\/div>)+/g,function(j){return g(j.split("</div><div>").length+1)})+"</p>"}i=i.replace(/<\/div><div>/g,"<br>");i=i.replace(/<\/?div>/g,"")}if((CKEDITOR.env.gecko||CKEDITOR.env.opera)&&h.enterMode!=CKEDITOR.ENTER_BR){if(CKEDITOR.env.gecko){i=i.replace(/^<br><br>$/,"<br>")}if(i.indexOf("<br><br>")>-1){i="<p>"+i.replace(/(<br>){2,}/g,function(j){return g(j.length/4)})+"</p>"}}return b(h,i)}function e(m){var h=new CKEDITOR.htmlParser.filter;var i={blockquote:1,dl:1,fieldset:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ol:1,p:1,table:1,ul:1},k=CKEDITOR.tools.extend({br:0},CKEDITOR.dtd.$inline),l={p:1,br:1,"cke:br":1},g=CKEDITOR.dtd,j=CKEDITOR.tools.extend({area:1,basefont:1,embed:1,iframe:1,map:1,object:1,param:1},CKEDITOR.dtd.$nonBodyContent,CKEDITOR.dtd.$cdata);var o=function(p){delete p.name;p.add(new CKEDITOR.htmlParser.text(" "))},n=function(q){var s=q,p,r;while((s=s.next)&&s.name&&s.name.match(/^h\d$/)){p=new CKEDITOR.htmlParser.element("cke:br");p.isEmpty=true;q.add(p);while(r=s.children.shift()){q.add(r)}}};h.addRules({elements:{h1:n,h2:n,h3:n,h4:n,h5:n,h6:n,img:function(q){var r=CKEDITOR.tools.trim(q.attributes.alt||""),p=" ";if(r&&!r.match(/(^http|\.(jpe?g|gif|png))/i)){p=" ["+r+"] "}return new CKEDITOR.htmlParser.text(p)},td:o,th:o,$:function(q){var r=q.name,p;if(j[r]){return false}q.attributes={};if(r=="br"){return q}if(i[r]){q.name="p"}else{if(k[r]){delete q.name}else{if(g[r]){p=new CKEDITOR.htmlParser.element("cke:br");p.isEmpty=true;if(CKEDITOR.dtd.$empty[r]){return p}q.add(p,0);p=p.clone();p.isEmpty=true;q.add(p);delete q.name}}}if(!l[q.name]){delete q.name}return q}}},{applyToAll:true});return h}function c(h,k,i){var g=new CKEDITOR.htmlParser.fragment.fromHtml(k),j=new CKEDITOR.htmlParser.basicWriter;g.writeHtml(j,i);k=j.getHtml();k=k.replace(/\s*(<\/?[a-z:]+ ?\/?>)\s*/g,"$1").replace(/(<cke:br \/>){2,}/g,"<cke:br />").replace(/(<cke:br \/>)(<\/?p>|<br \/>)/g,"$2").replace(/(<\/?p>|<br \/>)(<cke:br \/>)/g,"$1").replace(/<(cke:)?br( \/)?>/g,"<br>").replace(/<p><\/p>/g,"");var l=0;k=k.replace(/<\/?p>/g,function(m){if(m=="<p>"){if(++l>1){return"</p><p>"}}else{if(--l>0){return"</p><p>"}}return m}).replace(/<p><\/p>/g,"");return b(h,k)}function b(g,h){if(g.enterMode==CKEDITOR.ENTER_BR){h=h.replace(/(<\/p><p>)+/g,function(i){return CKEDITOR.tools.repeat("<br>",i.length/7*2)}).replace(/<\/?p>/g,"")}else{if(g.enterMode==CKEDITOR.ENTER_DIV){h=h.replace(/<(\/)?p>/g,"<$1div>")}}return h}})();