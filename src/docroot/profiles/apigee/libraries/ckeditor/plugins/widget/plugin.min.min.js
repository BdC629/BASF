"use strict";(function(){var U=15;CKEDITOR.plugins.add("widget",{lang:"ca,cs,cy,de,el,en,en-gb,es,fa,fi,hu,ja,km,ko,nb,nl,no,pl,pt,ru,sv,uk,zh,zh-cn",requires:"lineutils,clipboard",onLoad:function(){CKEDITOR.addCss(".cke_widget_wrapper{position:relative;outline:none}.cke_widget_inline{display:inline-block}.cke_widget_wrapper:hover>.cke_widget_element{outline:2px solid yellow;cursor:default}.cke_widget_wrapper:hover .cke_widget_editable{outline:2px solid yellow}.cke_widget_wrapper.cke_widget_focused>.cke_widget_element,.cke_widget_wrapper .cke_widget_editable.cke_widget_editable_focused{outline:2px solid #ace}.cke_widget_editable{cursor:text}.cke_widget_drag_handler_container{position:absolute;width:"+U+"px;height:0;left:-9999px;opacity:0.75;transition:height 0s 0.2s;line-height:0}.cke_widget_wrapper:hover>.cke_widget_drag_handler_container{height:"+U+"px;transition:none}.cke_widget_drag_handler_container:hover{opacity:1}img.cke_widget_drag_handler{cursor:move;width:"+U+"px;height:"+U+"px;display:inline-block}.cke_widget_mask{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.cke_editable.cke_widget_dragging, .cke_editable.cke_widget_dragging *{cursor:move !important}")},beforeInit:function(af){af.widgets=new ae(af)},afterInit:function(af){y(af);O(af)}});function ae(af){this.editor=af;this.registered={};this.instances={};this.selected=[];this.focused=null;this.widgetHoldingFocusedEditable=null;this._={nextId:0,upcasts:[],upcastCallbacks:[],filters:{}};m(this);N(this);I(this);Z(this);W(this);ad(this)}ae.prototype={MIN_SELECTION_CHECK_INTERVAL:500,add:function(ag,af){af=CKEDITOR.tools.prototypedCopy(af);af.name=ag;af._=af._||{};this.editor.fire("widgetDefinition",af);if(af.template){af.template=new CKEDITOR.template(af.template)}l(this.editor,af);r(this,af);if(!af.button){this.editor.addFeature(af)}this.registered[ag]=af;return af},addUpcastCallback:function(af){this._.upcastCallbacks.push(af)},checkSelection:function(){var ah=this.editor.getSelection(),ak=ah.getSelectedElement(),aj=ac(this),ag;if(ak&&(ag=this.getByElement(ak,true))){return aj.focus(ag).select(ag).commit()}var af=ah.getRanges()[0];if(!af||af.collapsed){return aj.commit()}var ai=new CKEDITOR.dom.walker(af),al;ai.evaluator=w;while(al=ai.next()){aj.select(this.getByElement(al))}aj.commit()},checkWidgets:function(af){this.fire("checkWidgets",CKEDITOR.tools.copy(af||{}))},del:function(ai){if(this.focused===ai){var ag=ai.editor,af=ag.createRange(),ah;if(!(ah=af.moveToClosestEditablePosition(ai.wrapper,true))){ah=af.moveToClosestEditablePosition(ai.wrapper,false)}if(ah){ag.getSelection().selectRanges([af])}}ai.wrapper.remove();this.destroy(ai,true)},destroy:function(ag,af){if(this.widgetHoldingFocusedEditable===ag){P(this,ag,null,af)}ag.destroy(af);delete this.instances[ag.id];this.fire("instanceDestroyed",ag)},destroyAll:function(af){var ah=this.instances,ag;for(var ai in ah){ag=ah[ai];this.destroy(ag,af)}},finalizeCreation:function(af){var ah=af.getFirst();if(ah&&w(ah)){this.editor.insertElement(ah);var ag=this.getByElement(ah);ag.ready=true;ag.fire("ready");ag.focus()}},getByElement:function(af,ai){if(!af){return null}var ah;for(var ag in this.instances){ah=this.instances[ag].wrapper;if(ah.equals(af)||!ai&&ah.contains(af)){return this.instances[ag]}}return null},initOn:function(ah,af,ag){if(!af){af=this.registered[ah.data("widget")]}else{if(typeof af=="string"){af=this.registered[af]}}if(!af){return null}var aj=this.wrapElement(ah,af.name);if(aj){if(aj.hasClass("cke_widget_new")){var ai=new g(this,this._.nextId++,ah,af,ag);if(ai.isInited()){this.instances[ai.id]=ai;return ai}else{return null}}return this.getByElement(ah)}return null},initOnAll:function(ah){var ag=(ah||this.editor.editable()).find(".cke_widget_new"),ai=[],af;for(var aj=ag.count();aj--;){af=this.initOn(ag.getItem(aj).getFirst(p));if(af){ai.push(af)}}return ai},wrapElement:function(ah,ak){var al=null,af,aj;if(ah instanceof CKEDITOR.dom.element){af=this.registered[ak||ah.data("widget")];if(!af){return null}al=ah.getParent();if(al&&al.type==CKEDITOR.NODE_ELEMENT&&al.data("cke-widget-wrapper")){return al}if(!ah.hasAttribute("data-cke-widget-keep-attr")){ah.data("cke-widget-keep-attr",ah.data("widget")?1:0)}if(ak){ah.data("widget",ak)}aj=G(af,ah.getName());al=new CKEDITOR.dom.element(aj?"span":"div");al.setAttributes(E(aj));al.data("cke-display-name",af.pathName?af.pathName:ah.getName());if(ah.getParent(true)){al.replace(ah)}ah.appendTo(al)}else{if(ah instanceof CKEDITOR.htmlParser.element){af=this.registered[ak||ah.attributes["data-widget"]];if(!af){return null}al=ah.parent;if(al&&al.type==CKEDITOR.NODE_ELEMENT&&al.attributes["data-cke-widget-wrapper"]){return al}if(!("data-cke-widget-keep-attr"in ah.attributes)){ah.attributes["data-cke-widget-keep-attr"]=ah.attributes["data-widget"]?1:0}if(ak){ah.attributes["data-widget"]=ak}aj=G(af,ah.name);al=new CKEDITOR.htmlParser.element(aj?"span":"div",E(aj));al.attributes["data-cke-display-name"]=af.pathName?af.pathName:ah.name;var ai=ah.parent,ag;if(ai){ag=ah.getIndex();ah.remove()}al.add(ah);ai&&X(ai,ag,al)}}return al},_tests_getNestedEditable:t,_tests_createEditableFilter:e};CKEDITOR.event.implementOn(ae.prototype);function g(aj,ak,ah,af,ag){var ai=aj.editor;CKEDITOR.tools.extend(this,af,{editor:ai,id:ak,inline:ah.getParent().getName()=="span",element:ah,data:CKEDITOR.tools.extend({},typeof af.defaults=="function"?af.defaults():af.defaults),dataReady:false,inited:false,ready:false,edit:g.prototype.edit,focusedEditable:null,definition:af,repository:aj,draggable:af.draggable!==false,_:{downcastFn:af.downcast&&typeof af.downcast=="string"?af.downcasts[af.downcast]:af.downcast}},true);aj.fire("instanceCreated",this);k(this,af);this.init&&this.init();this.inited=true;s(this,ag);if(this.isInited()&&ai.editable().contains(this.wrapper)){this.ready=true;this.fire("ready")}}g.prototype={destroy:function(af){var ah=this.editor;this.fire("destroy");if(this.editables){for(var ag in this.editables){this.destroyEditable(ag,af)}}if(!af){if(this.element.data("cke-widget-keep-attr")=="0"){this.element.removeAttribute("data-widget")}this.element.removeAttributes(["data-cke-widget-data","data-cke-widget-keep-attr"]);this.element.removeClass("cke_widget_element");this.element.replace(this.wrapper)}this.wrapper=null},destroyEditable:function(ah,af){var ag=this.editables[ah];ag.removeListener("focus",n);ag.removeListener("blur",o);this.editor.focusManager.remove(ag);if(!af){ag.removeClass("cke_widget_editable");ag.removeClass("cke_widget_editable_focused");ag.removeAttributes(["contenteditable","data-cke-widget-editable","data-cke-enter-mode"])}delete this.editables[ah]},edit:function(){var af={dialog:this.dialog},ag=this;if(!this.fire("edit",af)||!af.dialog){return}this.editor.openDialog(af.dialog,function(aj){var ah,ai;if(!ag.fire("dialog",aj)){return}ah=aj.on("show",function(){aj.setupContent(ag)});ai=aj.on("ok",function(){var al,ak=ag.on("data",function(am){al=1;am.cancel()},null,null,0);ag.editor.fire("saveSnapshot");aj.commitContent(ag);ak.removeListener();if(al){ag.fire("data",ag.data);ag.editor.fire("saveSnapshot")}});aj.once("hide",function(){ah.removeListener();ai.removeListener()})})},initEditable:function(ah,ag){var af=this.wrapper.findOne(ag.selector);if(af&&af.is(CKEDITOR.dtd.$editable)){af=new j(this.editor,af,{filter:e.call(this.repository,this.name,ah,ag)});this.editables[ah]=af;af.setAttributes({contenteditable:"true","data-cke-widget-editable":ah,"data-cke-enter-mode":af.enterMode});if(af.filter){af.data("cke-filter",af.filter.id)}af.addClass("cke_widget_editable");af.removeClass("cke_widget_editable_focused");if(ag.pathName){af.data("cke-display-name",ag.pathName)}this.editor.focusManager.add(af);af.on("focus",n,this);CKEDITOR.env.ie&&af.on("blur",o,this);af.setData(af.getHtml());return true}return false},isInited:function(){return!!(this.wrapper&&this.inited)},isReady:function(){return this.isInited()&&this.ready},focus:function(){var af=this.editor.getSelection();if(af){af.fake(this.wrapper)}this.editor.focus()},setData:function(ag,aj){var ai=this.data,af=0;if(typeof ag=="string"){if(ai[ag]!==aj){ai[ag]=aj;af=1}}else{var ah=ag;for(ag in ah){if(ai[ag]!==ah[ag]){af=1;ai[ag]=ah[ag]}}}if(af&&this.dataReady){aa(this);this.fire("data",ai)}return this},setFocused:function(af){this.wrapper[af?"addClass":"removeClass"]("cke_widget_focused");this.fire(af?"focus":"blur");return this},setSelected:function(af){this.wrapper[af?"addClass":"removeClass"]("cke_widget_selected");this.fire(af?"select":"deselect");return this},updateDragHandlerPosition:function(){var ah=this.editor,ai=this.element.$,af=this._.dragHandlerOffset,ag={x:ai.offsetLeft,y:ai.offsetTop-U};if(af&&ag.x==af.x&&ag.y==af.y){return}ah.fire("lockSnapshot");this.dragHandlerContainer.setStyles({top:ag.y+"px",left:ag.x+"px"});ah.fire("unlockSnapshot");this._.dragHandlerOffset=ag}};CKEDITOR.event.implementOn(g.prototype);function j(ai,ag,af){CKEDITOR.dom.element.call(this,ag.$);this.editor=ai;var ah=this.filter=af.filter;if(!CKEDITOR.dtd[this.getName()].p){this.enterMode=this.shiftEnterMode=CKEDITOR.ENTER_BR}else{this.enterMode=ah?ah.getAllowedEnterMode(ai.enterMode):ai.enterMode;this.shiftEnterMode=ah?ah.getAllowedEnterMode(ai.shiftEnterMode,true):ai.shiftEnterMode}}j.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.dom.element.prototype),{setData:function(af){af=this.editor.dataProcessor.toHtml(af,{context:this.getName(),filter:this.filter,enterMode:this.enterMode});this.setHtml(af)},getData:function(){return this.editor.dataProcessor.toDataFormat(this.getHtml(),{context:this.getName(),filter:this.filter,enterMode:this.enterMode})}});function y(ag){var af=ag.widgets.registered,ai,ah,aj;for(ah in af){ai=af[ah];aj=ai.button;if(aj&&ag.ui.addButton){ag.ui.addButton(CKEDITOR.tools.capitalize(ai.name,true),{label:aj,command:ai.name,toolbar:"insert,10"})}}}function l(ag,af){ag.addCommand(af.name,{exec:function(){var an=ag.widgets.focused;if(an&&an.name==af.name){an.edit()}else{if(af.insert){af.insert()}else{if(af.template){var am=typeof af.defaults=="function"?af.defaults():af.defaults,ak=CKEDITOR.dom.element.createFromHtml(af.template.output(am)),ah,ao=ag.widgets.wrapElement(ak,af.name),ai=new CKEDITOR.dom.documentFragment(ao.getDocument());ai.append(ao);ah=ag.widgets.initOn(ak,af);if(!ah){al();return}var aj=ah.once("edit",function(ap){if(ap.data.dialog){ah.once("dialog",function(aq){var at=aq.data,ar,au;ar=at.once("ok",al,null,null,20);au=at.once("cancel",function(){ag.widgets.destroy(ah,true)});at.once("hide",function(){ar.removeListener();au.removeListener()})})}else{al()}},null,null,999);ah.edit();aj.removeListener()}}}function al(){ag.widgets.finalizeCreation(ai)}},refresh:function(ah,ai){this.setState(t(ah.editable(),ai.blockLimit)?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_OFF)},context:"div",allowedContent:af.allowedContent,requiredContent:af.requiredContent,contentForms:af.contentForms,contentTransformations:af.contentTransformations})}function r(ah,af){var ai=af.upcast,ag;if(!ai){return}if(typeof ai=="string"){ag=ai.split(",");while(ag.length){ah._.upcasts.push([af.upcasts[ag.pop()],af.name])}}else{ah._.upcasts.push([ai,af.name])}}function ab(af,ag){af.focused=null;if(ag.isInited()){af.fire("widgetBlurred",{widget:ag});ag.setFocused(false)}}function T(al){var am=al.data;if(this.editor.mode!="wysiwyg"){return}var ah=this.editor.editable(),af=this.instances,an,ai,aj,ag;if(!ah){return}for(ai in af){if(!ah.contains(af[ai].wrapper)){this.destroy(af[ai],true)}}if(am&&am.initOnlyNew){an=this.initOnAll()}else{var ak=ah.find(".cke_widget_wrapper");an=[];for(ai=0,aj=ak.count();ai<aj;ai++){ag=ak.getItem(ai);if(!this.getByElement(ag,true)&&!B(ag,u)){ag.addClass("cke_widget_new");an.push(this.initOn(ag.getFirst(p)))}}}if(am&&am.focusInited&&an.length==1){an[0].focus()}}function q(ag){var af=ag.parent;if(af.type==CKEDITOR.NODE_ELEMENT&&af.attributes["data-cke-widget-wrapper"]){af.replaceWith(ag)}}function D(aj,ag){var ak=ag.find(".cke_widget_wrapper"),al,ai,ah=0,af=ak.count();for(;ah<af;++ah){al=ak.getItem(ah);ai=al.getFirst(p);if(ai.type==CKEDITOR.NODE_ELEMENT&&ai.data("widget")){ai.replace(al);aj.wrapElement(ai)}else{al.remove()}}}function e(ag,aj,ai){if(!ai.allowedContent){return null}var ah=this._.filters[ag];if(!ah){this._.filters[ag]=ah={}}var af=ah[aj];if(!af){ah[aj]=af=new CKEDITOR.filter(ai.allowedContent)}return af}function d(ag){var ai=[],af=ag._.upcasts,ah=ag._.upcastCallbacks;return{toBeWrapped:ai,iterator:function(am){var ap,an,ao,al,ak,aj;if("data-cke-widget-wrapper"in am.attributes){am=am.getFirst(V);if(am){ai.push([am])}return false}else{if("data-widget"in am.attributes){ai.push([am]);return false}else{if(ak=af.length){for(al=0,aj=ah.length;al<aj;++al){if(ah[al](am)===false){return}}for(al=0;al<ak;++al){ap=af[al];ao={};if(an=ap[0](am,ao)){if(an instanceof CKEDITOR.htmlParser.element){am=an}am.attributes["data-cke-widget-data"]=JSON.stringify(ao);ai.push([am,ap[1]]);return false}}}}}}}}function B(af,ah){var ag=af;while(ag=ag.getParent()){if(ah(ag)){return true}}return false}function t(ag,af){if(!af||af.equals(ag)){return null}if(b(af)){return af}return t(ag,af.getParent())}function E(af){return{tabindex:-1,contenteditable:"false","data-cke-widget-wrapper":1,"data-cke-filter":"off",class:"cke_widget_wrapper cke_widget_new cke_widget_"+(af?"inline":"block")}}function X(ai,ag,ah){if(ai.type==CKEDITOR.NODE_ELEMENT){var ak=CKEDITOR.dtd[ai.name];if(ak&&!ak[ah.name]){var af=ai.split(ag),aj=ai.parent;ag=af.getIndex();if(!ai.children.length){ag-=1;ai.remove()}if(!af.children.length){af.remove()}return X(aj,ag,ah)}}ai.add(ah,ag)}function V(af){return af.type==CKEDITOR.NODE_ELEMENT&&!!af.attributes["data-widget"]}function p(af){return af.type==CKEDITOR.NODE_ELEMENT&&af.hasAttribute("data-widget")}function G(ag,af){return typeof ag.inline=="boolean"?ag.inline:!!CKEDITOR.dtd.$inline[af]}function a(af){return af.type==CKEDITOR.NODE_ELEMENT&&af.attributes["data-cke-widget-wrapper"]}function w(af){return af.type==CKEDITOR.NODE_ELEMENT&&af.hasAttribute("data-cke-widget-wrapper")}function b(af){return af.type==CKEDITOR.NODE_ELEMENT&&af.hasAttribute("data-cke-widget-editable")}function u(af){return af.hasAttribute("data-cke-temp")}function J(af){return af.type==CKEDITOR.NODE_ELEMENT&&af.hasAttribute("data-cke-widget-drag-handler")}function h(ah,ag,af){ag.focus();ah.fire("saveSnapshot");ah.fire("lockSnapshot",{dontUpdate:true});af.select();var ai=ag.wrapper.getOuterHtml();ag.wrapper.remove();ah.widgets.destroy(ag,true);ah.execCommand("paste",ai);ah.fire("unlockSnapshot")}function S(aj,ag){var ah=ag.data.$,al,af=aj.createRange();if(ag.data.testRange){return ag.data.testRange}if(document.caretRangeFromPoint){al=aj.document.$.caretRangeFromPoint(ah.clientX,ah.clientY);af.setStart(CKEDITOR.dom.node(al.startContainer),al.startOffset);af.collapse(true)}else{if(ah.rangeParent){af.setStart(CKEDITOR.dom.node(ah.rangeParent),ah.rangeOffset);af.collapse(true)}else{if(document.body.createTextRange){al=aj.document.getBody().$.createTextRange();al.moveToPoint(ah.clientX,ah.clientY);var ak="cke-temp-"+(new Date).getTime();al.pasteHTML('<span id="'+ak+'">​</span>');var ai=aj.document.getById(ak);af.moveToPosition(ai,CKEDITOR.POSITION_BEFORE_START);ai.remove()}else{return null}}}return af}function H(ai,aj){var ak=ai.focusedEditable,ag;if(aj==CKEDITOR.CTRL+65){var ah=ak.getBogus();ag=ai.editor.createRange();ag.selectNodeContents(ak);if(ah){ag.setEndAt(ah,CKEDITOR.POSITION_BEFORE_START)}ag.select();return false}else{if(aj==8||aj==46){var af=ai.editor.getSelection().getRanges();ag=af[0];return!(af.length==1&&ag.collapsed&&ag.checkBoundaryOfElement(ak,CKEDITOR[aj==8?"START":"END"]))}}}function P(ah,ai,aj,af){var ag=ah.editor;ag.fire("lockSnapshot");if(aj){var al=aj.data("cke-widget-editable"),ak=ai.editables[al];ah.widgetHoldingFocusedEditable=ai;ai.focusedEditable=ak;aj.addClass("cke_widget_editable_focused");if(ak.filter){ag.setActiveFilter(ak.filter)}ag.setActiveEnterMode(ak.enterMode,ak.shiftEnterMode)}else{if(!af){ai.focusedEditable.removeClass("cke_widget_editable_focused")}ai.focusedEditable=null;ah.widgetHoldingFocusedEditable=null;ag.setActiveFilter(null);ag.setActiveEnterMode(null,null)}ag.fire("unlockSnapshot")}function O(af){if(!af.contextMenu){return}af.contextMenu.addListener(function(ag){var ah=af.widgets.getByElement(ag,true);if(ah){return ah.fire("contextMenu",{})}})}var M=new RegExp('^(?:<(?:div|span)(?: data-cke-temp="1")?(?: id="cke_copybin")?(?: data-cke-temp="1")?>)?(?:<(?:div|span)(?: style="[^"]+")?>)?<span [^>]*data-cke-copybin-start="1"[^>]*>.?</span>([\\s\\S]+)<span [^>]*data-cke-copybin-end="1"[^>]*>.?</span>(?:</(?:div|span)>)?(?:</(?:div|span)>)?$');function C(af,ag){return CKEDITOR.tools.trim(ag)}function W(ah){var ag=ah.editor,af=CKEDITOR.plugins.lineutils;ag.on("contentDom",function(){var ai=ag.editable(),aj=CKEDITOR.env.ie&&CKEDITOR.env.version<9||ai.isInline()?ai:ag.document;ai.attachListener(aj,"drop",function(ak){var ao=ak.data.$.dataTransfer.getData("text"),am,an,al;if(!ao){return}try{am=JSON.parse(ao)}catch(ap){return}if(am.type!="cke-widget"){return}ak.data.preventDefault();if(am.editor!=ag.name||!(an=ah.instances[am.id])){return}al=S(ag,ak);if(!al){return}if(CKEDITOR.env.gecko){setTimeout(h,0,ag,an,al)}else{h(ag,an,al)}});CKEDITOR.tools.extend(ah,{finder:new af.finder(ag,{lookups:{default:function(ak){if(ak.is(CKEDITOR.dtd.$listItem)){return}if(!ak.is(CKEDITOR.dtd.$block)){return}while(ak){if(b(ak)){return}ak=ak.getParent()}return CKEDITOR.LINEUTILS_BEFORE|CKEDITOR.LINEUTILS_AFTER}}}),locator:new af.locator(ag),liner:new af.liner(ag,{lineStyle:{cursor:"move !important","border-top-color":"#666"},tipLeftStyle:{"border-left-color":"#666"},tipRightStyle:{"border-right-color":"#666"}})},true)})}function I(ag){var af=ag.editor;af.on("contentDom",function(){var ah=af.editable(),ai=ah.isInline()?ah:af.document,aj,ak;ah.attachListener(ai,"mousedown",function(al){var am=al.data.getTarget();if(!am.type){return false}aj=ag.getByElement(am);ak=0;if(aj){if(aj.inline&&am.type==CKEDITOR.NODE_ELEMENT&&am.hasAttribute("data-cke-widget-drag-handler")){ak=1;return}if(!t(aj.wrapper,am)){al.data.preventDefault();if(!CKEDITOR.env.ie){aj.focus()}}else{aj=null}}});ah.attachListener(ai,"mouseup",function(){if(aj&&ak){ak=0;aj.focus()}});if(CKEDITOR.env.ie){ah.attachListener(ai,"mouseup",function(al){if(aj){setTimeout(function(){aj.focus();aj=null})}})}});af.on("doubleclick",function(ah){var ai=ag.getByElement(ah.data.element);if(!ai||t(ai.wrapper,ah.data.element)){return}return ai.fire("doubleclick",{element:ah.data.element})},null,null,1)}function Z(ag){var af=ag.editor;af.on("key",function(ah){var ak=ag.focused,aj=ag.widgetHoldingFocusedEditable,ai;if(ak){ai=ak.fire("key",{keyCode:ah.data.keyCode})}else{if(aj){ai=H(aj,ah.data.keyCode)}}return ai},null,null,1)}function ad(ah){var ag=ah.editor;ag.on("contentDom",function(){var ai=ag.editable();ai.attachListener(ai,"copy",af);ai.attachListener(ai,"cut",af)});function af(ai){if(ah.focused){L(ah.focused,ai.name=="cut")}}}function N(ag){var af=ag.editor;af.on("selectionCheck",function(){ag.fire("checkSelection")});ag.on("checkSelection",ag.checkSelection,ag);af.on("selectionChange",function(ai){var ah=t(af.editable(),ai.data.selection.getStartElement()),ak=ah&&ag.getByElement(ah),aj=ag.widgetHoldingFocusedEditable;if(aj){if(aj!==ak||!aj.focusedEditable.equals(ah)){P(ag,aj,null);if(ak&&ah){P(ag,ak,ah)}}}else{if(ak&&ah){P(ag,ak,ah)}}});af.on("dataReady",function(ah){ac(ag).commit()});af.on("blur",function(){var ah;if(ah=ag.focused){ab(ag,ah)}if(ah=ag.widgetHoldingFocusedEditable){P(ag,ah,null)}})}function m(af){x(af);c(af);af.on("checkWidgets",T);af.editor.on("contentDomInvalidated",af.checkWidgets,af)}function c(ah){var ag=ah.editor,ai={},af=false;ag.on("toDataFormat",function(aj){var al=CKEDITOR.tools.getNextNumber(),ak=[];aj.data.downcastingSessionId=al;ai[al]=ak;aj.data.dataValue.forEach(function(an){var am=an.attributes,ao,ap;if("data-cke-widget-id"in am){ao=ah.instances[am["data-cke-widget-id"]];if(ao){ap=an.getFirst(V);ak.push({wrapper:an,element:ap,widget:ao,editables:{}});if(ap.attributes["data-cke-widget-keep-attr"]!="1"){delete ap.attributes["data-widget"]}}}else{if("data-cke-widget-editable"in am){ak[ak.length-1].editables[am["data-cke-widget-editable"]]=an;return false}}},CKEDITOR.NODE_ELEMENT,true)},null,null,8);ag.on("toDataFormat",function(aj){if(!aj.data.downcastingSessionId){return}var ak=ai[aj.data.downcastingSessionId],ao,am,aq,al,ap,an;while(ao=ak.shift()){am=ao.widget;aq=ao.element;al=am._.downcastFn&&am._.downcastFn.call(am,aq);for(an in ao.editables){ap=ao.editables[an];delete ap.attributes.contenteditable;ap.setHtml(am.editables[an].getData())}if(!al){al=aq}ao.wrapper.replaceWith(al)}},null,null,13);ag.on("contentDomUnload",function(){ah.destroyAll(true)})}function x(ai){var ah=ai.editor,ag,aj;ah.on("toHtml",function(ak){var am=d(ai),al;ak.data.dataValue.forEach(am.iterator,CKEDITOR.NODE_ELEMENT,true);while(al=am.toBeWrapped.pop()){q(al[0]);ai.wrapElement(al[0],al[1])}ag=ak.data.dataValue.children.length==1&&a(ak.data.dataValue.children[0])},null,null,8);ah.on("dataReady",function(){if(aj){D(ai,ah.editable())}aj=0;ai.destroyAll(true);ai.initOnAll()});ah.on("loadSnapshot",function(ak){if(/data-cke-widget/.test(ak.data)){aj=1}ai.destroyAll(true)},null,null,9);ah.on("paste",function(ak){ak.data.dataValue=ak.data.dataValue.replace(M,C)});ah.on("insertText",af,null,null,999);ah.on("insertHtml",af,null,null,999);function af(){ah.fire("lockSnapshot");ai.checkWidgets({initOnlyNew:true,focusInited:ag});ah.fire("unlockSnapshot")}}function ac(ah){var ai=ah.selected,af=[],ag=ai.slice(0),aj=null;return{select:function(al){if(CKEDITOR.tools.indexOf(ai,al)<0){af.push(al)}var ak=CKEDITOR.tools.indexOf(ag,al);if(ak>=0){ag.splice(ak,1)}return this},focus:function(ak){aj=ak;return this},commit:function(){var ak=ah.focused!==aj,al;ah.editor.fire("lockSnapshot");if(ak&&(al=ah.focused)){ab(ah,al)}while(al=ag.pop()){ai.splice(CKEDITOR.tools.indexOf(ai,al),1);if(al.isInited()){al.setSelected(false)}}if(ak&&aj){ah.focused=aj;ah.fire("widgetFocused",{widget:aj});aj.setFocused(true)}while(al=af.pop()){ai.push(al);al.setSelected(true)}ah.editor.fire("unlockSnapshot")}}}var z="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D",F={37:1,38:1,39:1,40:1,8:1,46:1};function i(af){af.cancel()}function L(ai,ap){var an=ai.editor,aq=an.document;if(aq.getById("cke_copybin")){return}var am=an.blockless||CKEDITOR.env.ie?"span":"div",aj=aq.createElement(am),ao=aq.createElement(am),ar=CKEDITOR.env.ie&&CKEDITOR.env.version<9;ao.setAttributes({id:"cke_copybin","data-cke-temp":"1"});aj.setStyles({position:"absolute",width:"1px",height:"1px",overflow:"hidden"});aj.setStyle(an.config.contentsLangDirection=="ltr"?"left":"right","-5000px");aj.setHtml('<span data-cke-copybin-start="1">​</span>'+ai.wrapper.getOuterHtml()+'<span data-cke-copybin-end="1">​</span>');an.fire("saveSnapshot");an.fire("lockSnapshot");ao.append(aj);an.editable().append(ao);var al=an.on("selectionChange",i,null,null,0),ak=ai.repository.on("checkSelection",i,null,null,0);if(ar){var ag=aq.getDocumentElement().$,af=ag.scrollTop}var ah=an.createRange();ah.selectNodeContents(aj);ah.select();if(ar){ag.scrollTop=af}setTimeout(function(){if(!ap){ai.focus()}ao.remove();al.removeListener();ak.removeListener();an.fire("unlockSnapshot");if(ap){ai.repository.del(ai);an.fire("saveSnapshot")}},100)}function o(){var ah=CKEDITOR.document.getActive(),ag=this.editor,af=ag.editable();if((af.isInline()?af:ag.document.getWindow().getFrame()).equals(ah)){ag.focusManager.focus(af)}}function n(){if(CKEDITOR.env.gecko){this.editor.unlockSelection()}if(!CKEDITOR.env.webkit){this.editor.forceNextSelectionCheck();this.editor.selectionChange(1)}}function A(ai){if(!ai.draggable){return}var ah=ai.editor,af=ai.wrapper.findOne(".cke_widget_drag_handler_container"),ag;if(af){ag=af.findOne("img")}else{af=new CKEDITOR.dom.element("span",ah.document);af.setAttributes({class:"cke_reset cke_widget_drag_handler_container",style:"background:rgba(220,220,220,0.5);background-image:url("+ah.plugins.widget.path+"images/handle.png)"});ag=new CKEDITOR.dom.element("img",ah.document);ag.setAttributes({class:"cke_reset cke_widget_drag_handler","data-cke-widget-drag-handler":"1",src:z,width:U,title:ah.lang.widget.move,height:U});ai.inline&&ag.setAttribute("draggable","true");af.append(ag);ai.wrapper.append(af)}ai.wrapper.on("mouseenter",ai.updateDragHandlerPosition,ai);setTimeout(function(){ai.on("data",ai.updateDragHandlerPosition,ai)},50);if(ai.inline){ag.on("dragstart",function(aj){aj.data.$.dataTransfer.setData("text",JSON.stringify({type:"cke-widget",editor:ah.name,id:ai.id}))})}else{ag.on("mousedown",v,ai)}ai.dragHandlerContainer=af}function v(){var ag=this.repository.finder,aj=this.repository.locator,af=this.repository.liner,al=this.editor,ah=al.editable(),ao=[],am=[],aq=ag.greedySearch(),ai=CKEDITOR.tools.eventsBuffer(50,function(){an=aj.locate(aq);am=aj.sort(ap,1);if(am.length){af.prepare(aq,an);af.placeLine(am[0]);af.cleanup()}}),an,ap;ah.addClass("cke_widget_dragging");ao.push(ah.on("mousemove",function(ar){ap=ar.data.$.clientY;ai.input()}));function ak(){var ar;ai.reset();while(ar=ao.pop()){ar.removeListener()}R.call(this,am)}ao.push(al.document.once("mouseup",ak,this));ao.push(CKEDITOR.document.once("mouseup",ak,this))}function R(ah){var ak=this.repository.finder,ag=this.repository.liner,aj=this.editor,ai=this.editor.editable();if(!CKEDITOR.tools.isEmpty(ag.visible)){var af=ak.getRange(ah[0]);this.focus();aj.fire("saveSnapshot");aj.fire("lockSnapshot",{dontUpdate:1});aj.getSelection().reset();ai.insertElementIntoRange(this.wrapper,af);this.focus();aj.fire("unlockSnapshot");aj.fire("saveSnapshot")}ai.removeClass("cke_widget_dragging");ag.hideVisible()}function Y(ah){var ai,ag,af=ah.editables;ah.editables={};if(!ah.editables){return}for(ai in af){ag=af[ai];ah.initEditable(ai,typeof ag=="string"?{selector:ag}:ag)}}function K(ag){if(!ag.mask){return}var af=ag.wrapper.findOne(".cke_widget_mask");if(!af){af=new CKEDITOR.dom.element("img",ag.editor.document);af.setAttributes({src:z,class:"cke_reset cke_widget_mask"});ag.wrapper.append(af)}ag.mask=af}function Q(ah){if(ah.parts){var ai={},ag,af;for(af in ah.parts){ag=ah.wrapper.findOne(ah.parts[af]);ai[af]=ag}ah.parts=ai}}function k(ag,af){f(ag);Q(ag);Y(ag);K(ag);A(ag);if(CKEDITOR.env.ie&&CKEDITOR.env.version<9){ag.wrapper.on("dragstart",function(ah){var ai=ah.data.getTarget();if(!t(ag,ai)&&!(ag.inline&&J(ai))){ah.data.preventDefault()}})}ag.wrapper.removeClass("cke_widget_new");ag.element.addClass("cke_widget_element");ag.on("key",function(ah){var ai=ah.data.keyCode;if(ai==13){ag.edit()}else{if(ai==CKEDITOR.CTRL+67||ai==CKEDITOR.CTRL+88){L(ag,ai==CKEDITOR.CTRL+88);return}else{if(ai in F||CKEDITOR.CTRL&ai||CKEDITOR.ALT&ai){return}}}return false},null,null,999);ag.on("doubleclick",function(ah){ag.edit();ah.cancel()});if(af.data){ag.on("data",af.data)}if(af.edit){ag.on("edit",af.edit)}}function s(ag,af){var ah=ag.element.data("cke-widget-data");if(ah){ag.setData(JSON.parse(ah))}if(af){ag.setData(af)}ag.dataReady=true;aa(ag);ag.fire("data",ag.data)}function f(af){var ag=af.wrapper=af.element.getParent();ag.setAttribute("data-cke-widget-id",af.id)}function aa(af){af.element.data("cke-widget-data",JSON.stringify(af.data))}CKEDITOR.plugins.widget=g;g.repository=ae;g.nestedEditable=j})();