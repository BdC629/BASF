(function(){function c(e,d){d=d===undefined||d;var g;if(d){g=e.getComputedStyle("text-align")}else{while(!e.hasAttribute||!(e.hasAttribute("align")||e.getStyle("text-align"))){var f=e.getParent();if(!f){break}e=f}g=e.getStyle("text-align")||e.getAttribute("align")||""}g&&(g=g.replace(/(?:-(?:moz|webkit)-)?(?:start|auto)/i,""));!g&&d&&(g=e.getComputedStyle("direction")=="rtl"?"right":"left");return g}function b(f,d,g){this.editor=f;this.name=d;this.value=g;this.context="p";var e=f.config.justifyClasses,h=f.config.enterMode==CKEDITOR.ENTER_P?"p":"div";if(e){switch(g){case"left":this.cssClassName=e[0];break;case"center":this.cssClassName=e[1];break;case"right":this.cssClassName=e[2];break;case"justify":this.cssClassName=e[3];break}this.cssClassRegex=new RegExp("(?:^|\\s+)(?:"+e.join("|")+")(?=$|\\s)");this.requiredContent=h+"("+this.cssClassName+")"}else{this.requiredContent=h+"{text-align}"}this.allowedContent={"caption div h1 h2 h3 h4 h5 h6 p pre td th li":{propertiesOnly:true,styles:this.cssClassName?null:"text-align",classes:this.cssClassName||null}};if(f.config.enterMode==CKEDITOR.ENTER_BR){this.allowedContent.div=true}}function a(j){var h=j.editor;var d=h.createRange();d.setStartBefore(j.data.node);d.setEndAfter(j.data.node);var k=new CKEDITOR.dom.walker(d),i;while(i=k.next()){if(i.type==CKEDITOR.NODE_ELEMENT){if(!i.equals(j.data.node)&&i.getDirection()){d.setStartAfter(i);k=new CKEDITOR.dom.walker(d);continue}var f=h.config.justifyClasses;if(f){if(i.hasClass(f[0])){i.removeClass(f[0]);i.addClass(f[2])}else{if(i.hasClass(f[2])){i.removeClass(f[2]);i.addClass(f[0])}}}var g="text-align";var l=i.getStyle(g);if(l=="left"){i.setStyle(g,"right")}else{if(l=="right"){i.setStyle(g,"left")}}}}}b.prototype={exec:function(k){var n=k.getSelection(),m=k.config.enterMode;if(!n){return}var e=n.createBookmarks(),d=n.getRanges();var o=this.cssClassName,j,g;var f=k.config.useComputedState;f=f===undefined||f;for(var h=d.length-1;h>=0;h--){j=d[h].createIterator();j.enlargeBr=m!=CKEDITOR.ENTER_BR;while(g=j.getNextParagraph(m==CKEDITOR.ENTER_P?"p":"div")){if(g.isReadOnly()){continue}g.removeAttribute("align");g.removeStyle("text-align");var l=o&&(g.$.className=CKEDITOR.tools.ltrim(g.$.className.replace(this.cssClassRegex,"")));var p=this.state==CKEDITOR.TRISTATE_OFF&&(!f||c(g,true)!=this.value);if(o){if(p){g.addClass(o)}else{if(!l){g.removeAttribute("class")}}}else{if(p){g.setStyle("text-align",this.value)}}}}k.focus();k.forceNextSelectionCheck();n.selectBookmarks(e)},refresh:function(d,f){var e=f.block||f.blockLimit;this.setState(e.getName()!="body"&&c(e,this.editor.config.useComputedState)==this.value?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)}};CKEDITOR.plugins.add("justify",{lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en,en-au,en-ca,en-gb,eo,es,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,ug,uk,vi,zh,zh-cn",icons:"justifyblock,justifycenter,justifyleft,justifyright",hidpi:true,init:function(g){if(g.blockless){return}var h=new b(g,"justifyleft","left"),d=new b(g,"justifycenter","center"),f=new b(g,"justifyright","right"),e=new b(g,"justifyblock","justify");g.addCommand("justifyleft",h);g.addCommand("justifycenter",d);g.addCommand("justifyright",f);g.addCommand("justifyblock",e);if(g.ui.addButton){g.ui.addButton("JustifyLeft",{label:g.lang.justify.left,command:"justifyleft",toolbar:"align,10"});g.ui.addButton("JustifyCenter",{label:g.lang.justify.center,command:"justifycenter",toolbar:"align,20"});g.ui.addButton("JustifyRight",{label:g.lang.justify.right,command:"justifyright",toolbar:"align,30"});g.ui.addButton("JustifyBlock",{label:g.lang.justify.block,command:"justifyblock",toolbar:"align,40"})}g.on("dirChanged",a)}})})();