(function(){var b=/^(?:td|th)$/;function s(E){var v=E.getRanges();var w=[];var F={};function C(G){if(w.length>0){return}if(G.type==CKEDITOR.NODE_ELEMENT&&b.test(G.getName())&&!G.getCustomData("selected_cell")){CKEDITOR.dom.element.setMarker(F,G,"selected_cell",true);w.push(G)}}for(var A=0;A<v.length;A++){var B=v[A];if(B.collapsed){var x=B.getCommonAncestor();var z=x.getAscendant("td",true)||x.getAscendant("th",true);if(z){w.push(z)}}else{var u=new CKEDITOR.dom.walker(B);var y;u.guard=C;while(y=u.next()){if(y.type!=CKEDITOR.NODE_ELEMENT||!y.is(CKEDITOR.dtd.table)){var D=y.getAscendant("td",true)||y.getAscendant("th",true);if(D&&!D.getCustomData("selected_cell")){CKEDITOR.dom.element.setMarker(F,D,"selected_cell",true);w.push(D)}}}}}CKEDITOR.dom.element.clearAllMarkers(F);return w}function t(v){var w=0,x=v.length-1,z={},u,A,y;while(u=v[w++]){CKEDITOR.dom.element.setMarker(z,u,"delete_cell",true)}w=0;while(u=v[w++]){if((A=u.getPrevious())&&!A.getCustomData("delete_cell")||(A=u.getNext())&&!A.getCustomData("delete_cell")){CKEDITOR.dom.element.clearAllMarkers(z);return A}}CKEDITOR.dom.element.clearAllMarkers(z);y=v[0].getParent();if(y=y.getPrevious()){return y.getLast()}y=v[x].getParent();if(y=y.getNext()){return y.getChild(0)}return null}function a(M,z){var A=s(M),x=A[0],J=x.getAscendant("table"),N=x.getDocument(),u=A[0].getParent(),K=u.$.rowIndex,F=A[A.length-1],v=F.getParent().$.rowIndex+F.$.rowSpan-1,H=new CKEDITOR.dom.element(J.$.rows[v]),C=z?K:v,B=z?u:H;var L=CKEDITOR.tools.buildTableMap(J),D=L[C],G=z?L[C-1]:L[C+1],E=L[0].length;var y=N.createElement("tr");for(var I=0;D[I]&&I<E;I++){var w;if(D[I].rowSpan>1&&G&&D[I]==G[I]){w=D[I];w.rowSpan+=1}else{w=new CKEDITOR.dom.element(D[I]).clone();w.removeAttribute("rowSpan");w.appendBogus();y.append(w);w=w.$}I+=w.colSpan-1}z?y.insertBefore(B):y.insertAfter(B)}function c(D){if(D instanceof CKEDITOR.dom.selection){var z=s(D),x=z[0],I=x.getAscendant("table"),L=CKEDITOR.tools.buildTableMap(I),u=z[0].getParent(),K=u.$.rowIndex,E=z[z.length-1],v=E.getParent().$.rowIndex+E.$.rowSpan-1,J=[];for(var H=K;H<=v;H++){var C=L[H],A=new CKEDITOR.dom.element(I.$.rows[H]);for(var F=0;F<C.length;F++){var w=new CKEDITOR.dom.element(C[F]),y=w.getParent().$.rowIndex;if(w.$.rowSpan==1){w.remove()}else{w.$.rowSpan-=1;if(y==H){var M=L[H+1];M[F-1]?w.insertAfter(new CKEDITOR.dom.element(M[F-1])):new CKEDITOR.dom.element(I.$.rows[H+1]).append(w,1)}}F+=w.$.colSpan-1}J.push(A)}var B=I.$.rows;var G=new CKEDITOR.dom.element(B[v+1]||(K>0?B[K-1]:null)||I.$.parentNode);for(H=J.length;H>=0;H--){c(J[H])}return G}else{if(D instanceof CKEDITOR.dom.element){I=D.getAscendant("table");if(I.$.rows.length==1){I.remove()}else{D.remove()}}}return null}function k(u,v){var z=u.getParent(),A=z.$.cells;var x=0;for(var y=0;y<A.length;y++){var w=A[y];x+=v?1:w.colSpan;if(w==u.$){break}}return x-1}function h(x,v){var u=v?Infinity:0;for(var y=0;y<x.length;y++){var w=k(x[y],v);if(v?w<u:w>u){u=w}}return u}function n(C,A){var I=s(C),B=I[0],H=B.getAscendant("table"),v=h(I,1),y=h(I),E=A?v:y;var u=CKEDITOR.tools.buildTableMap(H),x=[],w=[],F=u.length;for(var z=0;z<F;z++){x.push(u[z][E]);var G=A?u[z][E-1]:u[z][E+1];w.push(G)}for(z=0;z<F;z++){var D;if(!x[z]){continue}if(x[z].colSpan>1&&w[z]==x[z]){D=x[z];D.colSpan+=1}else{D=new CKEDITOR.dom.element(x[z]).clone();D.removeAttribute("colSpan");D.appendBogus();D[A?"insertBefore":"insertAfter"].call(D,new CKEDITOR.dom.element(x[z]));D=D.$}z+=D.rowSpan-1}}function g(u){var y=s(u),x=y[0],E=y[y.length-1],J=x.getAscendant("table"),L=CKEDITOR.tools.buildTableMap(J),v,z,K=[];for(var I=0,B=L.length;I<B;I++){for(var G=0,C=L[I].length;G<C;G++){if(L[I][G]==x.$){v=G}if(L[I][G]==E.$){z=G}}}for(I=v;I<=z;I++){for(G=0;G<L.length;G++){var D=L[G],A=new CKEDITOR.dom.element(J.$.rows[G]),w=new CKEDITOR.dom.element(D[I]);if(w.$){if(w.$.colSpan==1){w.remove()}else{w.$.colSpan-=1}G+=w.$.rowSpan-1;if(!A.$.cells.length){K.push(A)}}}}var F=J.$.rows[0]&&J.$.rows[0].cells;var H=new CKEDITOR.dom.element(F[v]||(v?F[v-1]:J.$.parentNode));if(K.length==B){J.remove()}return H}function r(x){var w=[],A=x[0]&&x[0].getAscendant("table"),y,z,v,u;for(y=0,z=x.length;y<z;y++){w.push(x[y].$.cellIndex)}w.sort();for(y=1,z=w.length;y<z;y++){if(w[y]-w[y-1]>1){v=w[y-1]+1;break}}if(!v){v=w[0]>0?w[0]-1:w[w.length-1]+1}var B=A.$.rows;for(y=0,z=B.length;y<z;y++){u=B[y].cells[v];if(u){break}}return u?new CKEDITOR.dom.element(u):A.getPrevious()}function j(x,v){var w=x.getStartElement();var u=w.getAscendant("td",1)||w.getAscendant("th",1);if(!u){return}var y=u.clone();y.appendBogus();if(v){y.insertBefore(u)}else{y.insertAfter(u)}}function m(x){if(x instanceof CKEDITOR.dom.selection){var u=s(x);var y=u[0]&&u[0].getAscendant("table");var v=t(u);for(var w=u.length-1;w>=0;w--){m(u[w])}if(v){e(v,true)}else{if(y){y.remove()}}}else{if(x instanceof CKEDITOR.dom.element){var z=x.getParent();if(z.getChildCount()==1){z.remove()}else{x.remove()}}}}function f(u){var v=u.getBogus();v&&v.remove();u.trim()}function e(v,y){var u=v.getDocument(),x=CKEDITOR.document;if(CKEDITOR.env.ie&&CKEDITOR.env.version<11){x.focus();u.focus()}var w=new CKEDITOR.dom.range(u);if(!w["moveToElementEdit"+(y?"End":"Start")](v)){w.selectNodeContents(v);w.collapse(y?false:true)}w.select(true)}function q(y,x,u){var v=y[x];if(typeof u=="undefined"){return v}for(var w=0;v&&w<v.length;w++){if(u.is&&v[w]==u.$){return w}else{if(w==u){return new CKEDITOR.dom.element(v[w])}}}return u.is?-1:null}function o(y,u){var w=[];for(var v=0;v<y.length;v++){var x=y[v];w.push(x[u]);if(x[u].rowSpan>1){v+=x[u].rowSpan-1}}return w}function l(ab,H,K){var D=s(ab);var F;if((H?D.length!=1:D.length<2)||(F=ab.getCommonAncestor())&&F.type==CKEDITOR.NODE_ELEMENT&&F.is("table")){return false}var y,z=D[0],U=z.getAscendant("table"),W=CKEDITOR.tools.buildTableMap(U),R=W.length,T=W[0].length,u=z.getParent().$.rowIndex,E=q(W,u,z);if(H){var P;try{var Y=parseInt(z.getAttribute("rowspan"),10)||1;var A=parseInt(z.getAttribute("colspan"),10)||1;P=W[H=="up"?u-Y:H=="down"?u+Y:u][H=="left"?E-A:H=="right"?E+A:E]}catch(X){return false}if(!P||z.$==P){return false}D[H=="up"||H=="left"?"unshift":"push"](new CKEDITOR.dom.element(P))}var aa=z.getDocument(),x=u,Z=0,B=0,w=!K&&new CKEDITOR.dom.documentFragment(aa),V=0;for(var S=0;S<D.length;S++){y=D[S];var v=y.getParent(),J=y.getFirst(),I=y.$.colSpan,C=y.$.rowSpan,M=v.$.rowIndex,O=q(W,M,y);V+=I*C;B=Math.max(B,O-E+I);Z=Math.max(Z,M-u+C);if(!K){if(f(y),y.getChildren().count()){if(M!=x&&J&&!(J.isBlockBoundary&&J.isBlockBoundary({br:1}))){var L=w.getLast(CKEDITOR.dom.walker.whitespaces(true));if(L&&!(L.is&&L.is("br"))){w.append("br")}}y.moveChildren(w)}S?y.remove():y.setHtml("")}x=M}if(!K){w.moveChildren(z);z.appendBogus();if(B>=T){z.removeAttribute("rowSpan")}else{z.$.rowSpan=Z}if(Z>=R){z.removeAttribute("colSpan")}else{z.$.colSpan=B}var N=new CKEDITOR.dom.nodeList(U.$.rows),G=N.count();for(S=G-1;S>=0;S--){var Q=N.getItem(S);if(!Q.$.cells.length){Q.remove();G++;continue}}return z}else{return Z*B==V}}function d(N,B){var w=s(N);if(w.length>1){return false}else{if(B){return true}}var v=w[0],u=v.getParent(),J=u.getAscendant("table"),M=CKEDITOR.tools.buildTableMap(J),D=u.$.rowIndex,G=q(M,D,v),x=v.$.rowSpan,F,z,y,H;if(x>1){z=Math.ceil(x/2);y=Math.floor(x/2);H=D+z;var E=new CKEDITOR.dom.element(J.$.rows[H]),K=q(M,H),A;F=v.clone();for(var L=0;L<K.length;L++){A=K[L];if(A.parentNode==E.$&&L>G){F.insertBefore(new CKEDITOR.dom.element(A));break}else{A=null}}if(!A){E.append(F,true)}}else{y=z=1;E=u.clone();E.insertAfter(u);E.append(F=v.clone());var C=q(M,D);for(var I=0;I<C.length;I++){C[I].rowSpan++}}F.appendBogus();v.$.rowSpan=z;F.$.rowSpan=y;if(z==1){v.removeAttribute("rowSpan")}if(y==1){F.removeAttribute("rowSpan")}return F}function p(D,B){var I=s(D);if(I.length>1){return false}else{if(B){return true}}var F=I[0],A=F.getParent(),H=A.getAscendant("table"),u=CKEDITOR.tools.buildTableMap(H),C=A.$.rowIndex,E=q(u,C,F),x=F.$.colSpan,w,z,G;if(x>1){z=Math.ceil(x/2);G=Math.floor(x/2)}else{G=z=1;var y=o(u,E);for(var v=0;v<y.length;v++){y[v].colSpan++}}w=F.clone();w.insertAfter(F);w.appendBogus();F.$.colSpan=z;w.$.colSpan=G;if(z==1){F.removeAttribute("colSpan")}if(G==1){w.removeAttribute("colSpan")}return w}var i={thead:1,tbody:1,tfoot:1,td:1,tr:1,th:1};CKEDITOR.plugins.tabletools={requires:"table,dialog,contextmenu",init:function(v){var w=v.lang.table;function u(y){return CKEDITOR.tools.extend(y||{},{contextSensitive:1,refresh:function(z,A){this.setState(A.contains({td:1,th:1},1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}function x(y,A){var z=v.addCommand(y,A);v.addFeature(z)}x("cellProperties",new CKEDITOR.dialogCommand("cellProperties",u({allowedContent:"td th{width,height,border-color,background-color,white-space,vertical-align,text-align}[colspan,rowspan]",requiredContent:"table"})));CKEDITOR.dialog.add("cellProperties",this.path+"dialogs/tableCell.js");x("rowDelete",u({requiredContent:"table",exec:function(z){var y=z.getSelection();e(c(y))}}));x("rowInsertBefore",u({requiredContent:"table",exec:function(z){var y=z.getSelection();a(y,true)}}));x("rowInsertAfter",u({requiredContent:"table",exec:function(z){var y=z.getSelection();a(y)}}));x("columnDelete",u({requiredContent:"table",exec:function(A){var z=A.getSelection();var y=g(z);y&&e(y,true)}}));x("columnInsertBefore",u({requiredContent:"table",exec:function(z){var y=z.getSelection();n(y,true)}}));x("columnInsertAfter",u({requiredContent:"table",exec:function(z){var y=z.getSelection();n(y)}}));x("cellDelete",u({requiredContent:"table",exec:function(z){var y=z.getSelection();m(y)}}));x("cellMerge",u({allowedContent:"td[colspan,rowspan]",requiredContent:"td[colspan,rowspan]",exec:function(y){e(l(y.getSelection()),true)}}));x("cellMergeRight",u({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(y){e(l(y.getSelection(),"right"),true)}}));x("cellMergeDown",u({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(y){e(l(y.getSelection(),"down"),true)}}));x("cellVerticalSplit",u({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(y){e(d(y.getSelection()))}}));x("cellHorizontalSplit",u({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(y){e(p(y.getSelection()))}}));x("cellInsertBefore",u({requiredContent:"table",exec:function(z){var y=z.getSelection();j(y,true)}}));x("cellInsertAfter",u({requiredContent:"table",exec:function(z){var y=z.getSelection();j(y)}}));if(v.addMenuItems){v.addMenuItems({tablecell:{label:w.cell.menu,group:"tablecell",order:1,getItems:function(){var z=v.getSelection(),y=s(z);return{tablecell_insertBefore:CKEDITOR.TRISTATE_OFF,tablecell_insertAfter:CKEDITOR.TRISTATE_OFF,tablecell_delete:CKEDITOR.TRISTATE_OFF,tablecell_merge:l(z,null,true)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_right:l(z,"right",true)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_down:l(z,"down",true)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_vertical:d(z,true)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_horizontal:p(z,true)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_properties:y.length>0?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED}}},tablecell_insertBefore:{label:w.cell.insertBefore,group:"tablecell",command:"cellInsertBefore",order:5},tablecell_insertAfter:{label:w.cell.insertAfter,group:"tablecell",command:"cellInsertAfter",order:10},tablecell_delete:{label:w.cell.deleteCell,group:"tablecell",command:"cellDelete",order:15},tablecell_merge:{label:w.cell.merge,group:"tablecell",command:"cellMerge",order:16},tablecell_merge_right:{label:w.cell.mergeRight,group:"tablecell",command:"cellMergeRight",order:17},tablecell_merge_down:{label:w.cell.mergeDown,group:"tablecell",command:"cellMergeDown",order:18},tablecell_split_horizontal:{label:w.cell.splitHorizontal,group:"tablecell",command:"cellHorizontalSplit",order:19},tablecell_split_vertical:{label:w.cell.splitVertical,group:"tablecell",command:"cellVerticalSplit",order:20},tablecell_properties:{label:w.cell.title,group:"tablecellproperties",command:"cellProperties",order:21},tablerow:{label:w.row.menu,group:"tablerow",order:1,getItems:function(){return{tablerow_insertBefore:CKEDITOR.TRISTATE_OFF,tablerow_insertAfter:CKEDITOR.TRISTATE_OFF,tablerow_delete:CKEDITOR.TRISTATE_OFF}}},tablerow_insertBefore:{label:w.row.insertBefore,group:"tablerow",command:"rowInsertBefore",order:5},tablerow_insertAfter:{label:w.row.insertAfter,group:"tablerow",command:"rowInsertAfter",order:10},tablerow_delete:{label:w.row.deleteRow,group:"tablerow",command:"rowDelete",order:15},tablecolumn:{label:w.column.menu,group:"tablecolumn",order:1,getItems:function(){return{tablecolumn_insertBefore:CKEDITOR.TRISTATE_OFF,tablecolumn_insertAfter:CKEDITOR.TRISTATE_OFF,tablecolumn_delete:CKEDITOR.TRISTATE_OFF}}},tablecolumn_insertBefore:{label:w.column.insertBefore,group:"tablecolumn",command:"columnInsertBefore",order:5},tablecolumn_insertAfter:{label:w.column.insertAfter,group:"tablecolumn",command:"columnInsertAfter",order:10},tablecolumn_delete:{label:w.column.deleteColumn,group:"tablecolumn",command:"columnDelete",order:15}})}if(v.contextMenu){v.contextMenu.addListener(function(z,A,B){var y=B.contains({td:1,th:1},1);if(y&&!y.isReadOnly()){return{tablecell:CKEDITOR.TRISTATE_OFF,tablerow:CKEDITOR.TRISTATE_OFF,tablecolumn:CKEDITOR.TRISTATE_OFF}}return null})}},getSelectedCells:s};CKEDITOR.plugins.add("tabletools",CKEDITOR.plugins.tabletools)})();CKEDITOR.tools.buildTableMap=function(o){var n=o.$.rows;var a=-1;var m=[];for(var f=0;f<n.length;f++){a++;!m[a]&&(m[a]=[]);var l=-1;for(var e=0;e<n[f].cells.length;e++){var k=n[f].cells[e];l++;while(m[a][l]){l++}var d=isNaN(k.colSpan)?1:k.colSpan;var g=isNaN(k.rowSpan)?1:k.rowSpan;for(var b=0;b<g;b++){if(!m[a+b]){m[a+b]=[]}for(var h=0;h<d;h++){m[a+b][l+h]=n[f].cells[e]}}l+=d-1}}return m};