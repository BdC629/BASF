Apigee.APIModel.Common=function(){var self=this;var authModalPosition;var MODAL_TOP_CLOSE_BUTTON='<button aria-hidden="true" data-dismiss="modal" class="close button_close_modal" type="button">x</button>';var MODAL_BASIC_AUTH_HEADING="<h3>Set Authentication</h3>";var MODAL_EDIT_ADMIN_AUTH_HEADING="<h3>Set Organization Admin Credentials</h3>";var MODAL_INLINE_EDIT_CONFIRM_HEADING="<h3>Warning</h3>";var MODAL_CUSTOM_TOKEN_HEADING="<h3>Custom Token</h3>";if(typeof apiName!="undefined"){var MODAL_OAUTH2_HEADING="<h3>Request "+apiName+" permissions</h3>"}var MODAL_SESSION_WARNING="<p>Your credentials are saved for the session only.</p>";var MODAL_BUTTONS='<a class="btn btn-primary button_save_modal" href="javascript:void(0)">Save</a><a class="button_close_modal" href="javascript:void(0)">Cancel</a>';var MODAL_BUTTONS_EDIT=MODAL_BUTTONS.replace("Cancel","Discard");validateEmail=function(elementValue){var flag=false;if(jQuery.trim(elementValue).length>1){var regEx=RegExp(/^[a-zA-Z0-9_]{0,1}([a-zA-Z0-9_\.\-\+\&\/\$\!\#\%\'\*\=\?\^\`\{\|\}\~])+([a-zA-Z0-9_\-\+\&\/\$\!\#\%\'\*\=\?\^\`\{\|\}\~]{0,1})+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/);if(regEx.test(elementValue)){if(elementValue.indexOf("..")==-1)flag=true}}return flag};navigator.sayswho=function(){var N=navigator.appName,ua=navigator.userAgent,tem;var M=ua.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);if(M&&(tem=ua.match(/version\/([\.\d]+)/i))!=null)M[2]=tem[1];M=M?[M[1],M[2]]:[N,navigator.appVersion,"-?"];return M}();showMessage=function(msg){theParent=document.getElementsByTagName("body")[0];theKid=document.createElement("div");theKid.setAttribute("style","height:20px;width:100%;background-color:#F9F6C5;text-align:center;position:fixed;z-index:999;");theKid.innerHTML=msg;theParent.appendChild(theKid);theParent.insertBefore(theKid,theParent.firstChild)};this.makeAJAXCall=function(request){var requestUrl=request.url.toString();var currentHost=document.location.host.toString();if(requestUrl.indexOf("targeturl=")!=-1){requestUrl=requestUrl.split("targeturl=")[0].toString()}if(jQuery.browser.msie&&window.XDomainRequest&&parseInt(jQuery.browser.version)<=9&&requestUrl.indexOf(currentHost)==-1){var requestURL=request.url;var defaultMethodType=request.type?request.type:"get";if(requestURL.indexOf("targeturl")!=-1){var requestVerb=request.type?request.type:"get";requestURL+="&method="+requestVerb;defaultMethodType="POST"}if(request.headers){var headersList=request.headers;var headersString="{";for(var i=0,l=headersList.length;i<l;i++){headersString+='"'+headersList[i].name+'" : "'+headersList[i].value+'"';if(l!=1&&i!=l-1){headersString+=","}}headersString+="}";headersString=encodeURIComponent(headersString);requestURL+="&headers="+headersString}var methodData=request.data?request.data:null;xdr=new XDomainRequest;xdr.onload=function(){var data;var forJSON=true;try{data=jQuery.parseJSON(xdr.responseText)}catch(e){forJSON=false}if(!forJSON){request.callback(xdr.responseText)}else{if(data){var responseStatusCode=data.responseStatusCode;if(responseStatusCode){if(parseInt(responseStatusCode)>=400){if(request.errorCallback){request.errorCallback(responseStatusCode);jQuery("#working_alert").fadeOut();return}else{request.callback(data);jQuery("#working_alert").fadeOut();return}}}request.callback(data)}else{request.callback(xdr.responseText)}}jQuery("#working_alert").fadeOut()};xdr.onerror=function(){if(request.errorCallback){request.errorCallback(xdr.responseText)}else{request.callback(xdr.responseText)}jQuery("#working_alert").fadeOut()};xdr.open(defaultMethodType,requestURL);xdr.send(methodData)}else{jQuery.ajax({url:request.url,cache:false,type:request.hasOwnProperty("type")?request.type:"get",data:request.hasOwnProperty("data")?request.data:null,contentType:request.hasOwnProperty("contentType")?request.contentType:"application/x-www-form-urlencoded;charset=utf-8",processData:request.hasOwnProperty("processData")?request.processData:true,beforeSend:function(req){if(request.headers){for(var i=0,l=request.headers.length;i<l;i++){var header=request.headers[i];req.setRequestHeader(header.name,header.value)}}},success:function(data,textStatus,jqXHR){if(typeof data!="object"){request.callback(jqXHR.responseText)}else{if(data){var responseStatusCode=data.responseStatusCode;if(responseStatusCode){if(parseInt(responseStatusCode)>=400){if(request.errorCallback){request.errorCallback(responseStatusCode);return}else{request.callback(data);return}}}request.callback(data)}}},error:function(xhr,status,error){if(request.errorCallback){request.errorCallback(xhr.status)}else{request.callback(xhr.responseText)}},complete:function(){jQuery("#working_alert").fadeOut()}})}};this.closeAuthModal=function(){jQuery('[role="dialog"].modal').modal("hide");jQuery('[role="dialog"].modal input').removeClass("error");jQuery('[role="dialog"].modal .error_container').hide().html("")};this.validateBasicAuthFields=function(modalName){var errMessage="";userEmail=jQuery.trim(jQuery("[data-role='"+modalName+"']").find("#inputEmail").val());if(!userEmail.length){jQuery("#inputEmail").addClass("error");errMessage+="<span>Email/Username required.</span><br/>"}var userPasswordElement=jQuery("[data-role='"+modalName+"']").find("#inputPassword");if(!jQuery.trim(userPasswordElement.val()).length){userPasswordElement.addClass("error");errMessage+="<span>Password required.</span><br/>"}return errMessage};this.shortenText=function(element,len){var elementVal=element.text();if(elementVal.length>len){elementVal=elementVal.substring(0,len-3)+"...";element.text(elementVal)}};this.parseAndReturn=function(theText){var theJson="";try{theJson=jQuery.parseJSON(theText)}catch(e){theJson=theText}return theJson};this.getQueryParam=function(queryURL,paramName){var QueryString=queryURL.split("?");if(QueryString.length>2){QueryString=queryURL.split(/\?(.*)/)}if(QueryString.length>1){QueryString=QueryString[1];QueryString=QueryString.split("&");for(var i=0;i<QueryString.length;i++){var queryParam=QueryString[i].split("=");if(queryParam[0]==paramName){return queryParam[1]}}return""}return""};this.escapeSpecialChars=function(str){return str.replace(/\\n/g,"\\n").replace(/'/g,"'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")};this.showError=function(errorMessage){jQuery("[data-role='error_container']").html(errorMessage).show();jQuery("body").scrollTop(0)};this.showUnsupportedBrowserAlertMessage=function(){var browserNameAndVersion=navigator.sayswho.toString();var browserName=browserNameAndVersion.split(",")[0].toLowerCase();var version=parseInt(browserNameAndVersion.split(",")[1]);var msg="<p>You are using an unsupported browser. Please switch to Chrome, Firefox >= 10, Safari >= 6 or Internet Explorer >= 9. [ <a href='javascript:void(0)' onclick='apiModelCommon.hideUnsupportedBrowserMessage()'> Close</a> ]</p>";if(browserName!="chrome"){if(browserName=="firefox"){if(version<10){showMessage(msg)}}if(browserName=="safari"){if(version<6){showMessage(msg)}}if(browserName=="msie"){if(version<9){showMessage(msg)}}}};this.hideUnsupportedBrowserMessage=function(){document.getElementsByTagName("body")[0].getElementsByTagName("div")[0].style.display="none";localStorage.setItem("unsupportedBrowserFlag","true")};this.showUnsupportedAttachementAlertMessage=function(){showMessage("<p>Attachement is not supported in IE9. Please switch to Chrome, Firefox >= 10, Safari >= 6 or Internet Explorer >= 10. [ <a href='javascript:void(0)' onclick='apiModelCommon.hideUnsupportedAttachementMessage()'> Close</a> ]</p>")};this.hideUnsupportedAttachementMessage=function(){document.getElementsByTagName("body")[0].getElementsByTagName("div")[0].style.display="none";localStorage.setItem("unsupportedAttachmentFlag","true")};this.dateDiff=function(date1,date2){var datediff=date1.getTime()-date2.getTime();return datediff/(24*60*60*1e3)}};Apigee.APIModel.Editor=function(){var editor;this.initRequestPayloadEditor=function(){if(jQuery('[data-role="request-payload-example"]').length){jQuery('[data-role="request-payload-example"]').children("textarea").show();bodyPayloadElementValue=jQuery.trim(jQuery('[data-role="request-payload-example"]').find("textarea").val());jQuery(".request_payload textarea").val(bodyPayloadElementValue);bodyPayloadElement=jQuery(".request_payload textarea");if(bodyPayloadElement){var modeName=bodyPayloadElement.data("format")=="application/xml"?"xml":"javascript";editor=CodeMirror.fromTextArea(jQuery(".request_payload textarea").get(0),{mode:modeName,lineNumbers:true});if(editor.lineCount()<=2){editor.setSize("100%",editor.lineCount()*18)}else{editor.setSize("100%",editor.lineCount()*15)}}}};this.getRequestPayLoad=function(){return editor.getValue()};this.setRequestPayLoad=function(payload){editor.setValue(payload)}};Apigee.APIModel.Methods=function(){var self=this;var months=["January","February","March","April","May","June","July","August","September","October","November","December"];var lastModifiedDate;var methodURLElement;var basicAuth="";var userEmail="";var authType;var rawCode="";var bodyContent;var isTemplateParamMissing=false;var templateParamMissing=[];var isHeaderParamMissing=false;var headerParamMissing=[];var isQueryParamMissing=false;var queryParamMissing=[];var requestEditor;var responseEditor;var oauth2Credentials={};var customTokenObject={};var isCutomTokenShown=false;var custemTokenCredentials="";var selectedAuthScheme="";var windowLocation=window.location.href;var apiName=Apigee.APIModel.apiName;var revisionNumber=Apigee.APIModel.revisionNumber;var targetUrl="";var DEFAULT_OPTIONAL_PARAM_OPTION="-None-";this.init=function(){var authTypeElement=jQuery("[data-role='auth-type']");authType=jQuery.trim(authTypeElement.text());if(authType.split(",").length>1){authType=authType.substr(0,authType.length-1)}authType=authType.replace("BASICAUTH","Basic Auth").replace("CUSTOM","Custom Token").replace("OAUTH1WEBSERVER","OAuth 1").replace("OAUTH1CLIENTCREDENTIALS","OAuth 1 Client Credentials").replace("OAUTH2WEBSERVER","OAuth 2").replace("OAUTH2CLIENTCREDENTIALS","OAuth 2 Client Credentials").replace("OAUTH2IMPLICITGRANT","OAuth 2 Implicit Grant Flow").replace("NOAUTH","No auth");authTypeElement.html(authType);self.updateAuthContainer();var resourceURLString="";jQuery("[data-role='method_url_container'] span").each(function(){resourceURLString+='<span data-role="'+jQuery(this).attr("data-role")+'">'+jQuery(this).html()+"</span>"});jQuery("[data-role='method_url_container']").html(resourceURLString);methodURLElement=jQuery("[data-role='method_url_container']");methodURLElement.html(methodURLElement.html().replace(/\{/g,"<span data-toggle='tooltip' data-original-title=''><span class='template_param' contenteditable='true'>{").replace(/\}/g,"}</span><span></span></span>"));methodURLElement.find("span.template_param").each(function(){jQuery(this).siblings("span").attr("data-role",jQuery(this).text())});jQuery("[data-role='template-params']").find("p").each(function(){var templateParamName=jQuery(this).find("[data-role='name']").html();var templateParamDescription=jQuery(this).find("[data-role='description']").html();jQuery("[data-toggle='tooltip']").each(function(){var curElement=jQuery(this).find("span:eq(1)").data("role");if(curElement){curElement=curElement.substring(1,curElement.length-1);if(curElement==templateParamName){templateParamDescription=jQuery.trim(templateParamDescription);if(templateParamDescription.charAt(templateParamDescription.length-1)!="."){templateParamDescription+="."}jQuery(this).attr("data-original-title",templateParamDescription+" Click to edit the value.")}}})});if(localStorage.hasOwnProperty("templateParams")){var templateParams=JSON.parse(localStorage.getItem("templateParams"));for(var i=0;i<templateParams.length;i++){var paramName=templateParams[i].name;var paramValue=templateParams[i].value;jQuery("[data-role='method_url_container'] span.template_param").each(function(){var spanElement=jQuery(this).siblings("span");var inputElement=jQuery(this);if(spanElement.attr("data-role")==paramName){inputElement.text(jQuery.trim(paramValue))}})}}jQuery("[data-role='query-param-list'],[data-role='header-param-list'], [data-role='body-param-list'], [data-role='attachments-list']").each(function(i,obj){if(!jQuery(this).find("span.required").length&&jQuery(this).find(".value select").length){jQuery(this).find(".value select").prepend("<option value='"+DEFAULT_OPTIONAL_PARAM_OPTION+"' selected>"+DEFAULT_OPTIONAL_PARAM_OPTION+"</option>")}var valueElement=jQuery(this).find("[data-role='value']");valueElement.attr("data-original-value",jQuery.trim(valueElement.val()))});var categoryElement=jQuery("[data-role='category']");var categoryElementValue=jQuery.trim(categoryElement.text());if(categoryElementValue.split(",").length>1){categoryElementValue=categoryElementValue.substr(0,categoryElementValue.length-1)}categoryElement.html(categoryElementValue);if(jQuery("[data-role='request-payload-docs']").length&&!jQuery("[data-role='request-payload-example']").length){jQuery("[data-role='request-payload-docs']").show()}jQuery("#working_alert").css("left",jQuery(window).width()/2-56);jQuery("#method_content").show();window.apiModelEditor.initRequestPayloadEditor();var proxyURLLocation=windowLocation.split("/apimodels/")[0];if(typeof Drupal!="undefined"&&typeof Drupal.settings!="undefined"){proxyURLLocation=Drupal.settings.smartdocs.apiModelBaseUrl+"/v1/o/"+Apigee.APIModel.organizationName}if(Apigee.APIModel.apiModelBaseUrl){proxyURLLocation=Apigee.APIModel.apiModelBaseUrl+"/v1/o/"+Apigee.APIModel.organizationName}proxyURLLocation=proxyURLLocation+"/apimodels/proxyUrl";self.makeAJAXCall({url:proxyURLLocation,callback:self.storeProxyURL});Apigee.APIModel.initMethodsPageEvents();Apigee.APIModel.initMethodsAuthDialogsEvents()};this.storeProxyURL=function(data){Apigee.APIModel.proxyURL=data.proxyUrl;Apigee.APIModel.authUrl=data.authUrl;Apigee.APIModel.proxyURL=Apigee.APIModel.proxyURL+"/sendrequest"};this.renderCallbackURL=function(data){if(typeof Drupal!="undefined"&&typeof Drupal.settings!="undefined"){var oauth2AuthUrlPart1=data.authUrl.split("redirect_uri=")[0];var oauth2AuthUrlPart2=data.authUrl.split("redirect_uri=")[1];oauth2AuthUrlPart2=oauth2AuthUrlPart1+"redirect_uri="+encodeURIComponent(Drupal.settings.smartdocs.oauth2AuthUrl+"?org="+Apigee.APIModel.organizationName+"&api="+Apigee.APIModel.apiName+"&revision="+Apigee.APIModel.revisionNumber)+"&client_id="+oauth2AuthUrlPart2.split("client_id=")[1];window.open(oauth2AuthUrlPart2,"oauth2Window","resizable=yes,scrollbars=yes,status=1,toolbar=1,height=500,width=500")}else{window.open(data.authUrl,"oauth2Window","resizable=yes,scrollbars=yes,status=1,toolbar=1,height=500,width=500")}};this.handleOAuth2Failure=function(){self.showError("Unable to proceed because of missing OAuth configuration.")};this.renderCustomTokenCredentials=function(data){var defaultCustomTokenObject=data;var customTokenType=defaultCustomTokenObject.tokenType;var tokensLength=Object.keys(defaultCustomTokenObject.tokenMap).length;jQuery("[data-role='custom_token_row']").each(function(index){if(index>0){jQuery(this).remove()}});if(tokensLength>=1){for(var i=1,n=tokensLength;i<n;i++){jQuery("[data-role='custom_token_row']").first().clone().appendTo("[data-role='custom_token_rows']")}}var index=1;for(var key in defaultCustomTokenObject.tokenMap){var customTokenName=key;var customTokenValue=defaultCustomTokenObject.tokenMap[key];jQuery("[data-role='custom_token_row']:nth-child("+index+")").find("[data-role='name']").val(customTokenName);jQuery("[data-role='custom_token_row']:nth-child("+index+")").find("[data-role='value']").val(customTokenValue);index++}if(customTokenType=="header"){jQuery("[data-role='custom_token_modal']").find("[data-role='header']").attr("checked","checked")}else{jQuery("[data-role='custom_token_modal']").find("[data-role='query']").attr("checked","checked")}};this.handleCustomTokenFailure=function(){self.showError("Unable to proceed because of missing Custom token configuration.")};this.updateTemplateParamWidth=function(element,isRightArrow){var value=element.text();var size=value.length;if(size==0){size=8.4}else{size=Math.ceil(size*8.4)}if(isRightArrow){element.css("width",size)}else{element.css("width","auto")}};this.updateTemplateParamText=function(element){var value=element.text();var size=value.length;if(size==0){size=8.4;element.html("&nbsp;")}else{size=Math.ceil(size*8.4);if(element.html().indexOf("&nbsp;")!=-1){element.slice(element.html().indexOf("&nbsp;"),element.html().indexOf("&nbsp;")+1)}}};this.updateAuthContainer=function(){if(authType.indexOf("No auth")!=-1){jQuery("[data-role='authentication_container']").css({visibility:"hidden"});jQuery(".icon_lock").css({visibility:"hidden"})}else{if(authType.indexOf("Basic Auth")!=-1){if(authType.indexOf(",")==-1){sessionStorage.selectedAuthScheme=apiName+"@@@"+revisionNumber+"@@@"+"basicauth";selectedAuthScheme="basicauth"}var basicAuthCredentials="";if(localStorage.apisBasicAuthDetails){var date=new Date;var dateString=date.getMonth()+1+"/"+date.getDate()+"/"+date.getFullYear();var lsTimeStamp=localStorage.apisBasicAuthDetails.split("@@@")[3];var currentTimeStamp=dateString;var dtDiff=currentTimeStamp-lsTimeStamp;var dtDiff=parseInt(self.dateDiff(new Date(currentTimeStamp),new Date(lsTimeStamp)));if(dtDiff>30){localStorage.removeItem("apisBasicAuthDetails")}else{basicAuthCredentials=localStorage.apisBasicAuthDetails}}else if(sessionStorage.apisBasicAuthDetails){basicAuthCredentials=sessionStorage.apisBasicAuthDetails}if(basicAuthCredentials!==""){if(apiName==basicAuthCredentials.split("@@@")[0]){userEmail=basicAuthCredentials.split("@@@")[1];var emailString=userEmail;if(emailString.length>12){emailString=emailString.substring(0,12)+"..."}basicAuth=basicAuthCredentials.split("@@@")[2];if(sessionStorage.selectedAuthScheme){var selected=apiName==sessionStorage.selectedAuthScheme.split("@@@")[0]&&revisionNumber==sessionStorage.selectedAuthScheme.split("@@@")[1]&&sessionStorage.selectedAuthScheme.split("@@@")[2]=="basicauth"?"selected":""}if(selected!=""){jQuery("[data-role='basic_auth_container']").addClass(selected)}jQuery("[data-role='basic_auth_container']").find(".link_open_basicauth").html(emailString);jQuery("[data-role='basic_auth_container']").find(".icon-remove").css("display","inline-block")}}jQuery("[data-role='basic_auth_container']").show()}if(authType.indexOf("OAuth 2")!=-1){if(authType.indexOf(",")==-1){sessionStorage.selectedAuthScheme=apiName+"@@@"+revisionNumber+"@@@"+"oauth2";selectedAuthScheme="oauth2"}var authCredentials="";if(localStorage.apisOAuth2CredentialsDetails){var date=new Date;var dateString=date.getMonth()+1+"/"+date.getDate()+"/"+date.getFullYear();var lsTimeStamp=localStorage.apisOAuth2CredentialsDetails.split("@@@")[2];var currentTimeStamp=dateString;var dtDiff=currentTimeStamp-lsTimeStamp;var dtDiff=parseInt(self.dateDiff(new Date(currentTimeStamp),new Date(lsTimeStamp)));if(dtDiff>30){localStorage.removeItem("apisBasicAuthDetails")}else{authCredentials=localStorage.apisOAuth2CredentialsDetails}}else if(sessionStorage.apisOAuth2CredentialsDetails){authCredentials=sessionStorage.apisOAuth2CredentialsDetails}if(authCredentials!==""){if(apiName==authCredentials.split("@@@")[0]){oauth2Credentials=jQuery.parseJSON(authCredentials.split("@@@")[1]);var selected=apiName==authCredentials.split("@@@")[0]&&sessionStorage.selectedAuthScheme.split("@@@")[1]=="oauth2"?"selected":"";if(selected!=""){jQuery("[data-role='oauth2_container']").addClass(selected)}jQuery("[data-role='oauth2_container']").find(".link_open_oauth2").html("Authenticated");jQuery("[data-role='oauth2_container']").find(".icon-remove").css("display","inline-block")}}jQuery("[data-role='oauth2_container']").show()}if(authType.indexOf("Custom Token")!=-1){if(authType.indexOf(",")==-1){sessionStorage.selectedAuthScheme=apiName+"@@@"+revisionNumber+"@@@"+"customtoken";selectedAuthScheme="customtoken"}var custemTokenSession=sessionStorage.revisionsCustomTokenCredentialsDetails;if(custemTokenSession){if(apiName==custemTokenSession.split("@@@")[0]&&revisionNumber==custemTokenSession.split("@@@")[1]){customTokenObject=JSON.parse(custemTokenSession.split("@@@")[2]);var selected=apiName==sessionStorage.selectedAuthScheme.split("@@@")[0]&&revisionNumber==sessionStorage.selectedAuthScheme.split("@@@")[1]&&sessionStorage.selectedAuthScheme.split("@@@")[2]=="customtoken"?"selected":"";if(selected!=""){jQuery("[data-role='custom_token_container']").addClass(selected)}jQuery("[data-role='custom_token_container']").find(".link_open_customtoken").html("Custom Token");jQuery("[data-role='custom_token_container']").find(".icon-remove").css("display","inline-block")}}jQuery("[data-role='custom_token_container']").show()}Apigee.APIModel.initMethodsAuthDialogsEvents()}};this.swapSampleRequestResponseContainer=function(){var $currentElement=jQuery(this);if($currentElement.attr("id")=="link_request_tab"){jQuery("#link_response_tab").removeClass("selected");jQuery("#request_response_container .response").hide();jQuery("#request_response_container .request").show()}else{jQuery("#link_request_tab").removeClass("selected");jQuery("#request_response_container .request").hide();jQuery("#request_response_container .response").show()}$currentElement.addClass("selected")};this.saveAuthModal=function(e){var parentClass=jQuery(this).parents(".modal");if(parentClass.attr("data-role")=="basic_auth_modal"){var errMessage=self.validateBasicAuthFields("basic_auth_modal");if(errMessage==""){userEmail=jQuery("#inputEmail").val();basicAuth="Basic "+jQuery.base64Encode(userEmail+":"+jQuery("#inputPassword").val());var rememberCheckbox=jQuery("[data-role='basic_auth_modal']").find("#chk_remember").is(":checked");if(rememberCheckbox){var date=new Date;var dateString=date.getMonth()+1+"/"+date.getDate()+"/"+date.getFullYear();localStorage.apisBasicAuthDetails=apiName+"@@@"+userEmail+"@@@"+basicAuth+"@@@"+dateString}else{localStorage.removeItem("apisBasicAuthDetails");sessionStorage.apisBasicAuthDetails=apiName+"@@@"+userEmail+"@@@"+basicAuth}self.closeAuthModal();sessionStorage.selectedAuthScheme=apiName+"@@@"+revisionNumber+"@@@"+"basicauth";selectedAuthScheme="basicauth";self.updateAuthContainer()}else{jQuery("[role='dialog'].modal .error_container").html(errMessage+"Please try again.").show()}}else if(parentClass.attr("data-role")=="oauth2_modal"){var oauth2Url=window.location.href;oauth2Url=windowLocation.split("/resources/")[0];if(typeof Drupal!="undefined"&&typeof Drupal.settings!="undefined"){oauth2Url=Drupal.settings.smartdocs.apiModelBaseUrl+"/v1/o/"+Apigee.APIModel.organizationName+"/apimodels/"+Apigee.APIModel.apiName+"/revisions/"+Apigee.APIModel.revisionNumber}if(Apigee.APIModel.apiModelBaseUrl){oauth2Url=Apigee.APIModel.apiModelBaseUrl+"/v1/o/"+Apigee.APIModel.organizationName+"/apimodels/"+Apigee.APIModel.apiName+"/revisions/"+Apigee.APIModel.revisionNumber}self.closeAuthModal();self.makeAJAXCall({url:oauth2Url+"/authschemes/oauth2webserverflow/authUrl",dataType:"json",callback:self.renderCallbackURL,errorCallback:self.handleOAuth2Failure})}else if(parentClass.attr("data-role")=="custom_token_modal"){customTokenObject={};customTokenObject.tokenType=jQuery("[data-role='custom_token_modal']").find("[data-role='header']").attr("checked")=="checked"?"header":"query";customTokenObject.tokenMap={};jQuery("[data-role='custom_token_row']").each(function(){customTokenObject.tokenMap[jQuery(this).find("[data-role='name']").val()]=jQuery(this).find("[data-role='value']").val()});sessionStorage.revisionsCustomTokenCredentialsDetails=apiName+"@@@"+revisionNumber+"@@@"+JSON.stringify(customTokenObject);self.closeAuthModal();sessionStorage.selectedAuthScheme=apiName+"@@@"+revisionNumber+"@@@"+"customtoken";selectedAuthScheme="customtoken";self.updateAuthContainer()}};this.getCustomTokenCredentials=function(){if(!isCutomTokenShown){windowLocation=windowLocation.split("/resources/")[0];self.makeAJAXCall({url:windowLocation+"/authschemes/custom",dataType:"json",callback:self.renderCustomTokenCredentials,errorCallback:self.handleCustomTokenFailure});isCutomTokenShown=true}};this.toggleRequestPayload=function(e){var element=jQuery(this);if(!element.parent().hasClass("active")){element.parent().siblings().removeClass("active");element.parent().addClass("active");var role=element.attr("data-role");var requestPayloadDocsElement=jQuery("[data-role='request-payload-docs']");var requestPayloadExampleElement=jQuery("[data-role='request-payload-example']");if(requestPayloadDocsElement.siblings("textarea").length){requestPayloadDocsElement.siblings("textarea").hide();requestPayloadDocsElement.siblings("a.allow_edit").hide()}if(requestPayloadExampleElement.siblings("a.allow_edit").length){requestPayloadExampleElement.siblings("a.allow_edit").hide()}if(role=="docs-link"){requestPayloadExampleElement.hide();requestPayloadDocsElement.show()}else{requestPayloadDocsElement.hide();requestPayloadExampleElement.show()}}};this.resetFields=function(){jQuery("[data-role='query-param-list'],[data-role='header-param-list'],[data-role='body-param-list']").find("input").each(function(){jQuery(this).val("")});jQuery("[data-role='query-param-list'],[data-role='header-param-list']").each(function(i,obj){var valueElement=jQuery(this).find("[data-role='value']");valueElement.val(valueElement.attr("data-original-value"))});if(jQuery('[data-role="request-payload-example"]').length){var bodyPayloadElementValue=jQuery('[data-role="request-payload-example"]').children("textarea").val();window.apiModelEditor.setRequestPayLoad(bodyPayloadElementValue)}jQuery("#request_response_container .response").html("<p>Make a request and see the response.</p>");jQuery("#request_response_container .request").html("<p>Make a request and see the response.</p>");rawCode="";bodyContent=false};this.sendRequest=function(){jQuery("#working_alert").fadeIn();jQuery("#request_response_container .response").html("<p>Make a request and see the response.</p>");jQuery("#request_response_container .request").html("<p>Make a request and see the response.</p>");var templateInputElements=jQuery("[data-role='method_url_container'] span.template_param");if(templateInputElements.length>=1){if(localStorage.hasOwnProperty("templateParams")){var templateParams=JSON.parse(localStorage.getItem("templateParams"));jQuery("[data-role='method_url_container'] span.template_param").each(function(){var inputElementName=jQuery(this).siblings("span").attr("data-role");var inputElementValue=jQuery(this).text();if(inputElementName==inputElementValue||inputElementValue==""||jQuery(this).html()=="&nbsp;"){isTemplateParamMissing=true;templateParamMissing.push(inputElementName.substring(1,inputElementName.length-1));jQuery(this).addClass("error")}var isModified=false;for(var i=0;i<templateParams.length;i++){var paramName=templateParams[i].name;var paramValue=templateParams[i].value;if(inputElementName==paramName){isModified=true}if(inputElementName==paramName&&inputElementValue!=paramValue&&inputElementValue.length){templateParams[i].value=inputElementValue}}if(!isModified){templateParams.push({name:inputElementName,value:inputElementValue})}});localStorage.setItem("templateParams",JSON.stringify(templateParams))}else{var templateParamArray=[];jQuery("[data-role='method_url_container'] input").each(function(){var spanElement=jQuery(this).siblings("span");templateParamArray.push({name:spanElement.attr("data-role"),value:spanElement.html()})});localStorage.setItem("templateParams",JSON.stringify(templateParamArray))}}var urlToTest=jQuery("[data-role='method_url_container']").text();var methodVerb=jQuery.trim(jQuery("[data-role='verb']").text().toLowerCase());var headersList=[];if(jQuery("[data-role='header-param-list']").length){jQuery("[data-role='header-param-list']").each(function(i,obj){var headerParamName=jQuery(this).find("[data-role='name']").text();var headerParamValue;if(jQuery(this).find("[data-role='multiple-value']").length){headerParamValue=jQuery(this).find("select option:selected").val();headerParamValue=headerParamValue==DEFAULT_OPTIONAL_PARAM_OPTION?"":headerParamValue}else{headerParamValue=jQuery(this).find("[data-role='value']").val()}headersList.push({name:headerParamName,value:headerParamValue});if(jQuery(this).find("span.required").length&&jQuery(this).find("[data-role='value']").val()==""){isHeaderParamMissing=true;headerParamMissing.push(headerParamName);jQuery(this).find("[data-role='value']").addClass("error")}})}var queryParamString="";if(jQuery("[data-role='query-param-list']").length>=1){var isFistParam=true;jQuery("[data-role='query-param-list']").each(function(i,obj){var queryParamName=jQuery(this).find("[data-role='name']").text();var queryParamValue;if(jQuery(this).find("[data-role='multiple-value']").length){queryParamValue=jQuery(this).find("select option:selected").val();queryParamValue=queryParamValue==DEFAULT_OPTIONAL_PARAM_OPTION?"":queryParamValue}else{queryParamValue=jQuery(this).find("[data-role='value']").val()}if(jQuery.trim(queryParamValue).length>=1){var separator=isFistParam?"":"&";queryParamString+=separator+queryParamName+"="+encodeURIComponent(decodeURIComponent(queryParamValue));isFistParam=false}if(jQuery(this).find("span.required").length&&queryParamValue==""){isQueryParamMissing=true;queryParamMissing.push(queryParamName);jQuery(this).find("[data-role='value']").addClass("error")}})}var errorMessage="";var paramGroups=jQuery("[data-role='param-groups']");if(paramGroups.length){paramGroups.each(function(i,obj){var paramGroup=jQuery(this);var maxChoice=paramGroup.find("[data-role='maxChoice']").length?parseInt(paramGroup.find("[data-role='maxChoice']").text()):paramGroup.find("[data-role='param-group-list']").length;var minChoice=paramGroup.find("[data-role='minChoice']").length?parseInt(paramGroup.find("[data-role='minChoice']").text()):0;var counter=0;var paramGroupMissing=[];if(paramGroup.find("[data-role='param-group-list']").length){paramGroup.find("[data-role='param-group-list']").each(function(i,obj){var paramGroupName=jQuery(this).find("[data-role='name']").text();var paramGroupValue=jQuery(this).find("[data-role='value']").val();var paramGroupType=jQuery(this).find("[data-role='type']").text().toLowerCase();if(jQuery.trim(paramGroupValue).length>=1){counter++;if(paramGroupType=="query"){var separator=jQuery.trim(queryParamString).length?"&":"";queryParamString+=separator+paramGroupName+"="+encodeURIComponent(decodeURIComponent(paramGroupValue))}else if(paramGroupType=="header"){headersList.push({name:paramGroupName,value:paramGroupValue})}}else{paramGroupMissing.push(jQuery.trim(paramGroupName))}})}if(minChoice>counter){errorMessage+="Missing "+(maxChoice-counter)+" value for parameter group of: <span>"+paramGroupMissing.join(", ")+"</span></br>"}if(counter>maxChoice){errorMessage+="Number of entered parmeters exceeds the maximum number of choices in the parameter group</br>"}})}if(customTokenObject.tokenType=="query"){var separator=queryParamString!=""?"&":"";var index=0;for(var key in customTokenObject.tokenMap){separator=index==0?separator:"&";var customTokenName=key;var customTokenValue=customTokenObject.tokenMap[key];if(jQuery.trim(customTokenName)!=""&&jQuery.trim(customTokenValue)!=""){queryParamString+=separator+customTokenName+"="+customTokenValue;index++}}}else{for(var key in customTokenObject.tokenMap){var customTokenName=key;var customTokenValue=customTokenObject.tokenMap[key];if(jQuery.trim(customTokenName)!=""&&jQuery.trim(customTokenValue)!=""){headersList.push({name:customTokenName,value:customTokenValue})}}}if(jQuery.browser.msie&&parseInt(jQuery.browser.version)<=9&&jQuery("[data-role='body-param-list']").length){headersList.push({name:"Content-Type",value:"application/x-www-form-urlencoded"})}urlToTest=urlToTest.replace(/\{/g,"").replace(/\}/g,"");urlToTest=jQuery.trim(urlToTest);queryParamString=jQuery.trim(queryParamString);if(queryParamString!=""){var separator="?";if(urlToTest.indexOf("?")!=-1){separator="&"}urlToTest=urlToTest+separator+queryParamString}if(isTemplateParamMissing){errorMessage+="Missing value for template parameter(s): <span>"+templateParamMissing.join(", ")+"</span></br>"}if(isQueryParamMissing){errorMessage+="Missing value for required query parameter(s):&nbsp;<span>"+queryParamMissing.join(", ")+"</span></br>"}if(isHeaderParamMissing){errorMessage+="Missing value for required header parameter(s):&nbsp;<span>"+headerParamMissing.join(", ")+"</span></br>"}if(errorMessage!=""){jQuery("body").scrollTop(0);jQuery("[data-role='error_container']").html(errorMessage).show();self.clearMissingArray()}if(selectedAuthScheme=="basicauth"){if(basicAuth){if(localStorage.apisBasicAuthDetails&&apiName==localStorage.apisBasicAuthDetails.split("@@@")[0]){if(basicAuth!=localStorage.apisBasicAuthDetails.split("@@@")[2]){basicAuth=localStorage.apisBasicAuthDetails.split("@@@")[2];jQuery("[data-role='basic_auth_container']").find(".link_open_basicauth").html(localStorage.apisBasicAuthDetails.split("@@@")[1])}}headersList.push({name:"Authorization",value:basicAuth})}}else{if(selectedAuthScheme=="oauth2"&&oauth2Credentials!=null){if(localStorage.apisOAuth2CredentialsDetails&&apiName==localStorage.apisOAuth2CredentialsDetails.split("@@@")[0]){var credentialObj=jQuery.parseJSON(localStorage.apisOAuth2CredentialsDetails.split("@@@")[1]);if(credentialObj.accessToken!=oauth2Credentials.accessToken){oauth2Credentials=credentialObj}}if(oauth2Credentials.accessTokenType=="query"){var paramName=oauth2Credentials.accessToeknParamName==""?"oauth_token":oauth2Credentials.accessToeknParamName;var separator=queryParamString==""?"?":"&";urlToTest+=separator+paramName+"="+oauth2Credentials.accessToken}else if(oauth2Credentials.accessTokenType=="bearer"){headersList.push({name:"Authorization",value:"Bearer "+oauth2Credentials.accessToken})}}}targetUrl=urlToTest;urlToTest=encodeURIComponent(urlToTest).replace(/\{.*?\}/g,"");urlToTest=Apigee.APIModel.proxyURL+"?targeturl="+urlToTest;var bodyPayload=null;var contentTypeValue="application/x-www-form-urlencoded;charset=utf-8";var processDataValue=true;if(jQuery("[data-role='attachments-list']").length||jQuery('[data-role="request-payload-example"]').length&&jQuery("[data-role='body-param-list']").length){var multiPartTypes="";if(jQuery.browser.msie&&parseInt(jQuery.browser.version)<=9){if(localStorage.getItem("unsupportedAttachmentFlag")==null){self.showUnsupportedAttachementAlertMessage()}jQuery("#working_alert").fadeOut();return}if(jQuery("[data-role='body-param-list']").length){var formParams=jQuery("#formParams").serialize();if(!jQuery("#formAttachment input[name='root-fields']").length){jQuery("#formAttachment").prepend('<input type="hidden" name="root-fields" value="'+formParams+'"/>')}else{jQuery("#formAttachment input[name='root-fields']").val(formParams)}multiPartTypes="param";if(jQuery('[data-role="request-payload-example"]').length||jQuery("[data-role='attachments-list']").length){multiPartTypes+=jQuery('[data-role="request-payload-example"]').length?"+text":"";multiPartTypes+=jQuery("[data-role='attachments-list']").length?"+attachment":"";urlToTest+="&multiparttypes="+multiPartTypes}}else{for(var i=0,l=headersList.length;i<l;i++){if(headersList[i].name=="Content-Type"){headersList.splice(i,1)}}if(jQuery('[data-role="request-payload-example"]').length&&jQuery("[data-role='attachments-list']").length){urlToTest+="&multiparttypes=text+attachment"}}if(jQuery('[data-role="request-payload-example"]').length){if(!jQuery("#formAttachment textarea[name='text']").length){if(jQuery("#formAttachment input[name='root-fields']").length){jQuery("<textarea class='hide' name='text'>"+window.apiModelEditor.getRequestPayLoad()+"</textarea>").insertAfter("#formAttachment input[name='root-fields']")}else{jQuery("#formAttachment").prepend("<textarea class='hide' name='text'>"+window.apiModelEditor.getRequestPayLoad()+"</textarea>")}}else{jQuery("#formAttachment textarea[name='text']").val(window.apiModelEditor.getRequestPayLoad())}}if(jQuery("#formParams").length){bodyPayload=new FormData(jQuery("form")[1])}else{bodyPayload=new FormData(jQuery("form")[0])}contentTypeValue=false;processDataValue=false}else if(jQuery("[data-role='body-param-list']").length){if(jQuery("#formParams").length){bodyPayload=jQuery("#formParams").serialize()}else{bodyPayload=jQuery("#formAttachment").serialize()}}else{if(jQuery('[data-role="request-payload-example"]').length){bodyPayload=window.apiModelEditor.getRequestPayLoad()}}self.makeAJAXCall({url:urlToTest,type:methodVerb,data:bodyPayload,callback:self.renderRequest,headers:headersList,contentType:contentTypeValue,processData:processDataValue})};this.renderRequest=function(data){var responseContainerElement=jQuery("[data-role='response-container']");var requestContainerElement=jQuery("[data-role='request-container']");if(data==""||data==null){requestContainerElement.html("<strong> An internal error has occurred. Please retry your request.</strong>");responseContainerElement.html("<strong> An internal error has occurred. Please retry your request.</strong>");return}if(typeof data!="object"){data=jQuery.parseJSON(data)}rawCode=unescape(data.responseContent);var responseContainerString="<strong";var responseStatusCode;var httpVersion;var responseReasonPhrase;if(data.responseStatusCode){responseStatusCode=data.responseStatusCode;httpVersion=data.httpVersion;responseReasonPhrase=data.responseReasonPhrase}else{responseStatusCode=data.responseCode;httpVersion=data.messageVersion;responseReasonPhrase=data.responsePharse}if(parseInt(responseStatusCode)>=100&&parseInt(responseStatusCode)<400){responseContainerString+=" class='success'"}responseContainerString+="> HTTP/"+httpVersion+" "+responseStatusCode+"  "+responseReasonPhrase+"</strong>";responseContainerString+="<dl>";for(var i=0;i<data.responseHeaders.length;i++){responseContainerString+="<dt>";responseContainerString+=unescape(data.responseHeaders[i].name);responseContainerString+=": </dt><dd>";responseContainerString+=unescape(data.responseHeaders[i].value);responseContainerString+="</dd>"}responseContainerString+="</dl>";responseContainerElement.html(responseContainerString);if(rawCode!=""){var getAsJson=/^"\{/.test(rawCode)&&/\}"$/.test(rawCode)||/^"\[/.test(rawCode)&&/\]"$/.test(rawCode);if(getAsJson){rawCode=rawCode.replace(/^"((.|\s)*)"$/,"$1")}if(rawCode){var forJSON=true;try{var tmp=jQuery.parseJSON(rawCode)}catch(e){forJSON=false}if(forJSON){var rawasjson=self.parseAndReturn(rawCode);rawCode=JSON.stringify(rawasjson,null,2);rawCode=rawCode.replace("[{","[\n  {");rawCode=rawCode.replace(/,\n[\n ]*$/,"");rawCode=rawCode.replace(/\n(\s*)},\n{/g,"\n$1},\n$1{");responseContainerElement.append("<pre><code class='language-javascript' id='some-code123'>"+rawCode+"</code></pre>")}else{rawCode=rawCode.replace(/>/g,"&gt;").replace(/</g,"&lt;");responseContainerElement.append("<pre class='language-markup'><code class='language-markup' id='some-code'>"+rawCode+"</code></pre>")}}}var hostName=targetUrl.split("//")[1].split("/")[0].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");var urlPortion=targetUrl.split(hostName)[1].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");var requestContainerString="<strong>"+data.requestVerb+" "+urlPortion+" HTTP/"+httpVersion+"</strong>";requestContainerString+="<dl>";for(var i=0;i<data.requestHeaders.length;i++){var headerName=data.requestHeaders[i].name;if(headerName.toLowerCase()!="origin"&&headerName.toLowerCase()!="referer"){var headerValue=data.requestHeaders[i].value;requestContainerString+="<dt>";requestContainerString+=unescape(headerName);requestContainerString+=": </dt><dd>";requestContainerString+=unescape(headerValue).replace(/</g,"&lt").replace(/>/g,"&gt");requestContainerString+="</dd>"}}requestContainerString+="</dl>";requestContainerElement.html(requestContainerString);bodyContent=unescape(data.requestContent);bodyContent=bodyContent.replace(/[^\x00-\x7F]/g,"###");if(bodyContent.indexOf("###")!=-1){bodyContent=bodyContent.replace(bodyContent.substring(bodyContent.indexOf("###"),bodyContent.lastIndexOf("###")+3),"[BINARY DATA]")}if(bodyContent){var forJSON=true;try{tmp=jQuery.parseJSON(bodyContent)}catch(e){forJSON=false}if(forJSON){var rawasjson=self.parseAndReturn(bodyContent);bodyContent=JSON.stringify(rawasjson,null,2);bodyContent=bodyContent.replace("[{","[\n  {");bodyContent=bodyContent.replace(/,\n[\n ]*$/,"");bodyContent=bodyContent.replace(/\n(\s*)},\n{/g,"\n$1},\n$1{");requestContainerElement.append("<pre class='language-javascript'><code class='language-javascript' id='some-code'>"+bodyContent+"</code></pre>")}else{bodyContent=bodyContent.replace(/>/g,"&gt;").replace(/</g,"&lt;");requestContainerElement.append("<pre class='language-markup'><code class='language-markup' id='some-code'>"+bodyContent+"</code></pre>")}}if(typeof Prism=="object"){Prism.highlightAll()}};this.clearErrorContainer=function(){self.clearMissingBooleanVariables();self.clearMissingArray();jQuery("[data-role='error_container']").hide().html("")};this.clearMissingBooleanVariables=function(){isTemplateParamMissing=false;isHeaderParamMissing=false;isQueryParamMissing=false;isRequestBodyMissing=false};this.clearMissingArray=function(){templateParamMissing=[];headerParamMissing=[];queryParamMissing=[];requestBodyMissing=""};this.updateAuthModalFooter=function(modalClassName){var localStorageVariable=modalClassName=="basic_auth_modal"?"apisBasicAuthDetails":"apisOAuth2CredentialsDetails";if(localStorage.getItem(localStorageVariable)){jQuery("[data-role='"+modalClassName+"']").find(".modal-footer p").html('<input type="checkbox" checked id="chk_remember"> Remember credentials for 30 days.')}else if(!jQuery("[data-role='"+modalClassName+"']").find(".modal-footer p input").length){jQuery("[data-role='"+modalClassName+"']").find(".modal-footer p").append('<br><input type="checkbox" id="chk_remember"> Remember credentials for 30 days.')}jQuery("[data-role='"+modalClassName+"']").modal("show")};this.setOAuth2Credentials=function(obj){if(obj.errorMessage!=""){self.showError(obj.errorMessage)}else{oauth2Credentials=obj;selectedAuthScheme="oauth2";var rememberCheckbox=jQuery("[data-role='oauth2_modal']").find("#chk_remember").is(":checked");if(rememberCheckbox){var date=new Date;var dateString=date.getMonth()+1+"/"+date.getDate()+"/"+date.getFullYear();localStorage.apisOAuth2CredentialsDetails=apiName+"@@@"+JSON.stringify(oauth2Credentials)+"@@@"+dateString}else{localStorage.removeItem("apisOAuth2CredentialsDetails");sessionStorage.apisOAuth2CredentialsDetails=apiName+"@@@"+JSON.stringify(oauth2Credentials)}sessionStorage.selectedAuthScheme=apiName+"@@@"+revisionNumber+"@@@"+"oauth2";self.updateAuthContainer()}};this.toggleAuthScheme=function(e){jQuery("[data-role='authentication_container'] .well").removeClass("selected");jQuery(this).addClass("selected");if(jQuery(this).hasClass("basicauth")){sessionStorage.selectedAuthScheme=apiName+"@@@"+revisionNumber+"@@@"+"basicauth";selectedAuthScheme="basicauth"}else if(jQuery(this).hasClass("oauth2")){sessionStorage.selectedAuthScheme=apiName+"@@@"+revisionNumber+"@@@"+"oauth2";selectedAuthScheme="oauth2"}else if(jQuery(this).hasClass("customtoken")){sessionStorage.selectedAuthScheme=apiName+"@@@"+revisionNumber+"@@@"+"customtoken";selectedAuthScheme="customtoken"}};this.clearSessionStorage=function(type){type=typeof type.data=="undefined"?type:type.data;if(type=="oauth2"){sessionStorage.removeItem("apisOAuth2CredentialsDetails");localStorage.removeItem("apisOAuth2CredentialsDetails");oauth2Credentials=null;jQuery("[data-role='oauth2_container']").find(".link_open_oauth2").html("Set...").attr("title","Set OAuth 2 credentials.");jQuery("[data-role='oauth2_container']").find(".icon-remove").css("display","none")}else if(type=="basicauth"){basicAuth="";userEmail="";sessionStorage.removeItem("apisBasicAuthDetails");localStorage.removeItem("apisBasicAuthDetails");jQuery("[data-role='basic_auth_container']").find(".link_open_basicauth").html("Set...").attr("title","Set basic auth credentials.");jQuery("[data-role='basic_auth_container']").find(".icon-remove").css("display","none")}else if(type=="customtoken"){sessionStorage.removeItem("revisionsCustomTokenCredentialsDetails");jQuery("[data-role='custom_token_container']").find(".link_open_customtoken").html("Set...").attr("title","Set custom token credentials.");jQuery("[data-role='custom_token_container']").find(".icon-remove").css("display","none");isCutomTokenShown=false}Apigee.APIModel.initMethodsAuthDialogsEvents()}};Apigee.APIModel.Methods.prototype=new Apigee.APIModel.Common;Apigee.APIModel.InlineEdit=function(){var self=this;var editMode=0;var basicAuth;var windowLocation=window.location.href;var currentEdiatableElement=null;var currentEdiatableElementValue="";var editingFlag=false;var isAdminAuthModalReopened=false;var lastEditScope="method";var descriptionEditFlag=false;function clearEditSessions(){sessionStorage.removeItem("basicAuth1");sessionStorage.removeItem("userEmail1")}function constructParams(paramType,scope){var liEmenets;var typeVal;var paramString="";templateParamAvailable=false;if(paramType=="general"){liEmenets="[data-role='query-param-list'][data-scope='method'], [data-role='header-param-list'][data-scope='method']";if(scope=="resource"){liEmenets="[data-role='query-param-list'][data-scope='resource'], [data-role='header-param-list'][data-scope='resource']"}var searchTerm="[data-scope='method']";if(scope=="resource"){searchTerm="[data-scope='resource']"}jQuery("[data-role='template-params']").find(searchTerm).each(function(index){templateParamAvailable=true;paramString+='{"name" :"'+jQuery(this).find("[data-role='name']").text()+'",';paramString+='"description" :"'+jQuery(this).find("[data-role='description']").text()+'",';if(jQuery(this).find("[data-role='required']").length){paramString+='"required" : '+jQuery(this).find("[data-role='required']").text()+","}if(jQuery(this).find("[data-role='defaultValue']").length){paramString+='"defaultValue" :"'+jQuery(this).find("[data-role='defaultValue']").text()+'",'}paramString+='"type" :"TEMPLATE",';paramString+='"dataType" :"string"}';var noOfParam=jQuery("[data-role='template-params']").find(searchTerm).length;if(noOfParam>index+1){paramString+=","}})}else if(paramType=="body"){liEmenets="[data-role='body-param-list'][data-scope='method']";if(scope=="resource"){liEmenets="[data-role='body-param-list'][data-scope='resource']"}typeVal="BODY"}else if(paramType=="attachments"){liEmenets="[data-role='attachments-list']"}if(templateParamAvailable){paramString+=","}jQuery(liEmenets).each(function(index){var currentLIElement=jQuery(this);typeVal=paramType;if(paramType=="general"){typeVal=currentLIElement.attr("data-role")=="query-param-list"?"QUERY":"HEADER"}var requiredParam=currentLIElement.children(".title").find("[data-role='required']").text().indexOf("required")!=-1?true:false;var paramName;var descriptionValue;if(currentLIElement.find("div.title input[data-role='value']").length){paramName=jQuery.trim(currentLIElement.find("div.title input[data-role='value']").val())}else{paramName=jQuery.trim(currentLIElement.find("div.title span[data-role='name']").text())}if(currentLIElement.find("div.description textarea").length){descriptionValue=jQuery.trim(currentLIElement.find("div.description textarea").val())}else{descriptionValue=jQuery.trim(currentLIElement.find("[data-role='description']").html());if(currentEdiatableElement.is(currentLIElement.find("[data-role='description']"))){descriptionValue=jQuery.trim(currentLIElement.find("[data-role='description']").text())}}descriptionValue=JSON.stringify(descriptionValue);descriptionValue=descriptionValue.substring(1,descriptionValue.length-1);descriptionValue=self.escapeSpecialChars(descriptionValue);paramString+='{"name" :"'+paramName+'",';paramString+='"description" :"'+descriptionValue+'",';paramString+='"required" : '+requiredParam+",";if(paramType=="attachments"){paramString+='"sampleFileUrl" : "'+jQuery.trim(currentLIElement.find("[data-role='value']").attr("data-sample-file-url"))+'",';paramString+='"contentDisposition" : "'+jQuery.trim(currentLIElement.find("[data-role='value']").attr("data-content-disposition"))+'"}'}else{paramString+='"type" :"'+typeVal+'",';paramString+='"defaultValue" :"'+currentLIElement.find("[data-role='value']").val()+'",';paramString+='"dataType" :"string"}'}var noOfParam=jQuery(liEmenets).length;if(noOfParam>index+1){paramString+=","}});return paramString}function constructParamGroups(scope){var paramGroups=jQuery("[data-role='param-groups'][data-scope='"+scope+"']");var paramString="";if(paramGroups.length){paramGroups.each(function(i,obj){var paramGroup=jQuery(this);paramString+="{";if(paramGroup.find("[data-role='maxChoice']").length){paramString+=' "maxChoice" : '+parseInt(paramGroup.find("[data-role='maxChoice']").text())}if(paramGroup.find("[data-role='minChoice']").length){paramString+=paramGroup.find("[data-role='maxChoice']").length?",":"";paramString+='"minChoice" : '+parseInt(paramGroup.find("[data-role='minChoice']").text())}paramString+=', "parameters" : [ ';if(paramGroup.find("[data-role='param-group-list']").length){paramGroup.find("[data-role='param-group-list']").each(function(index,obj){var currentLIElement=jQuery(this);var paramGroupName=jQuery.trim(currentLIElement.find("[data-role='name']").text());var paramGroupValue=jQuery.trim(currentLIElement.find("[data-role='value']").val());var paramGroupType=jQuery.trim(currentLIElement.find("[data-role='type']").text());paramGroupType=paramGroupType.toUpperCase();var descriptionValue;if(currentLIElement.find("div.description textarea").length){descriptionValue=jQuery.trim(currentLIElement.find("div.description textarea").val())}else{descriptionValue=jQuery.trim(currentLIElement.find("div.description").text())}descriptionValue=JSON.stringify(descriptionValue);descriptionValue=descriptionValue.substring(1,descriptionValue.length-1);descriptionValue=self.escapeSpecialChars(descriptionValue);paramString+='{"name" :"'+paramGroupName+'",';paramString+='"defaultValue" :"'+paramGroupValue+'",';paramString+='"type" :"'+paramGroupType+'",';paramString+='"description" :"'+descriptionValue+'",';paramString+='"dataType" :"string"}';var noOfParam=paramGroup.find("[data-role='param-group-list']").length;if(noOfParam>index+1){paramString+=","}});paramString+="]"}paramString+="}";if(paramGroups.length>i+1){paramString+=","}})}return paramString}function updateParms(currentLIElement,data){var paramName=jQuery.trim(currentLIElement.find("[data-role='name']").text());var paramStyle="";var paramObject;if(currentLIElement.attr("data-role")=="query-param-list"){paramStyle="QUERY";paramObject=data.parameters}else if(currentLIElement.attr("data-role")=="header-param-list"){paramStyle="HEADER";paramObject=data.parameters}else if(currentLIElement.attr("data-role")=="body-param-list"){paramStyle="BODY";if(data.body){paramObject=data.body.parameters}}else if(currentLIElement.attr("data-role")=="attachments-list"){paramStyle="ATTACHMENT";if(data.body){paramObject=data.body.attachments}}else if(currentLIElement.attr("data-role")=="response_errors_list"){paramStyle="ERRORS";if(data.response){paramObject=data.response.errors}}if(paramObject){for(var i=0,len=paramObject.length;i<len;i++){var param=paramObject[i];if(paramStyle=="QUERY"||paramStyle=="HEADER"){if(param.name==paramName&&param.type==paramStyle){currentLIElement.find("[data-role='description']").html(param.description)}}else{if(param.name==paramName){currentLIElement.find("[data-role='description']").html(param.description)}}}}}function checkAdminCredentials(){if(localStorage.orgAdminBasicAuthDetails){jQuery("[data-role='edit_auth_modal']").find(".modal-footer p").html('<input type="checkbox" checked id="chk_remember"> Remember credentials for 30 days.')}else if(!jQuery("[data-role='edit_auth_modal']").find(".modal-footer p input").length){jQuery("[data-role='edit_auth_modal']").find(".modal-footer p").append('<br><input type="checkbox" id="chk_remember"> Remember credentials for 30 days.')}jQuery("[data-role='edit_auth_modal']").modal("show")}this.init=function(mode){editMode=mode;if(sessionStorage.orgAdminBasicAuthDetails||localStorage.orgAdminBasicAuthDetails){self.showAdminAuthenticationSection()}else{checkAdminCredentials()}Apigee.APIModel.initInlineEditAdminAuthEvents()};this.saveAuthModal=function(){var errMessage=self.validateBasicAuthFields("edit_auth_modal");if(errMessage==""){var windowLocation=window.location.href;var dataObj="password="+jQuery.trim(jQuery("[data-role='edit_auth_modal']").find("#inputPassword").val());if(Apigee.APIModel.authUrl!="null"){var authUrl=Apigee.APIModel.authUrl.replace("{user}",encodeURIComponent(userEmail));var headersList=[];headersList.push({name:"Content-Type",value:"application/x-www-form-urlencoded"});self.makeAJAXCall({url:Apigee.APIModel.proxyURL+"?targeturl="+authUrl,type:"post",dataType:"json",data:dataObj,callback:self.saveAdminCredentials,errorCallback:self.showUnauthorizedInfo,headers:headersList})}else{self.saveAdminCredentials()}}else{jQuery("[data-role='edit_auth_modal'] .error_container").html(errMessage+"Please try again.").show()}};this.saveAdminCredentials=function(){basicAuth="Basic "+jQuery.base64Encode(userEmail+":"+jQuery.trim(jQuery("[data-role='edit_auth_modal']").find("#inputPassword").val()));var rememberCheckbox=jQuery("[data-role='edit_auth_modal']").find("#chk_remember").is(":checked");if(rememberCheckbox){var date=new Date;var dateString=date.getMonth()+1+"/"+date.getDate()+"/"+date.getFullYear();localStorage.orgAdminBasicAuthDetails=basicAuth+"@@@"+userEmail+"@@@"+dateString}else{localStorage.removeItem("orgAdminBasicAuthDetails");sessionStorage.orgAdminBasicAuthDetails=basicAuth+"@@@"+userEmail}self.closeAuthModal();self.showAdminAuthenticationSection()};this.showUnauthorizedInfo=function(errorCode){if(errorCode=="401"){jQuery("[data-role='edit_auth_modal'] .error_container").html("Invalid credentials. Please try again.").show()}else{jQuery("[data-role='edit_auth_modal'] .error_container").html("Error saving details. Please try again.").show()}};this.showAdminAuthenticationSection=function(){var orgAdminCredentials="";if(localStorage.orgAdminBasicAuthDetails){var date=new Date;var dateString=date.getMonth()+1+"/"+date.getDate()+"/"+date.getFullYear();var lsTimeStamp=localStorage.orgAdminBasicAuthDetails.split("@@@")[2];var currentTimeStamp=dateString;var dtDiff=parseInt(self.dateDiff(new Date(currentTimeStamp),new Date(lsTimeStamp)));if(dtDiff>30){localStorage.removeItem("orgAdminBasicAuthDetails");checkAdminCredentials()}else{orgAdminCredentials=localStorage.orgAdminBasicAuthDetails}}else if(sessionStorage.orgAdminBasicAuthDetails){orgAdminCredentials=sessionStorage.orgAdminBasicAuthDetails}if(orgAdminCredentials!==""){basicAuth=orgAdminCredentials.split("@@@")[0];var emailString=orgAdminCredentials.split("@@@")[1];jQuery(".admin_auth_section a.auth_admin_email").html(emailString).show();jQuery(".admin_auth_section .icon-remove").css("display","inline-block");jQuery(".admin_auth_section").show().removeClass("hide")}else{localStorage.removeItem("orgAdminBasicAuthDetails");sessionStorage.removeItem("orgAdminBasicAuthDetails");jQuery(".admin_auth_section a.auth_admin_email").html("").hide();jQuery(".admin_auth_section .icon-remove").hide();jQuery(".admin_auth_section").show().removeClass("hide")}if(!isAdminAuthModalReopened){self.constructEditMode()}};this.clearAdminAuthDetails=function(){clearEditSessions();jQuery(this).siblings("a.auth_admin_email").html("").hide();jQuery(this).hide()};this.reOpenAdminAuthDetails=function(){isAdminAuthModalReopened=true;clearEditSessions();checkAdminCredentials();Apigee.APIModel.initInlineEditAdminAuthEvents()};this.constructEditMode=function(){jQuery("#method_content").addClass("edit_mode");var editIconHTML='<a class="allow_edit hover"></a><a class="allow_edit ok" title="save and quit."></a><a class="allow_edit cancel" title="reset and quit."></a>';jQuery(".edit_mode .resource_details").parent().addClass("clearfix");jQuery(".edit_mode .resource_details").children("div").addClass("clearfix");jQuery("[data-role='method-title']").parent().append(editIconHTML).addClass("clearfix");jQuery(".description_container").addClass("clearfix");jQuery("ul.method_table").parent().css({clear:"both"});if(jQuery("[data-role='query-param-list'],[data-role='header-param-list'], [data-role='body-param-list'], [data-role='param-group-list'], [data-role='response_errors_list'], [data-role='attachments-list'] ").length){jQuery("[data-role='query-param-list'],[data-role='header-param-list'], [data-role='body-param-list'], [data-role='param-group-list'], [data-role='response_errors_list'], [data-role='attachments-list']").each(function(i,obj){jQuery(this).find("[data-role='description']").parent().append(editIconHTML)})}jQuery(".description_container").append('<textarea class="resource_description_edit">'+jQuery("[data-role='method-description']").html()+"</textarea>"+editIconHTML);var requestPayLoadDocsContainer=jQuery("[data-role='request-payload-docs']");requestPayLoadDocsContainer.wrap("<div class='clearfix'></div>");requestPayLoadDocsContainer.attr("data-allow-edit","true");requestPayLoadDocsContainer.parent().append('<textarea class="request_payload_doc_edit"></textarea>'+editIconHTML);var requestPayLoadExampleContainer=jQuery("[data-role='request-payload-example']");requestPayLoadExampleContainer.wrap("<div class='clearfix'></div>");requestPayLoadExampleContainer.attr("data-allow-edit","true").width("90%").css({float:"left"});requestPayLoadExampleContainer.parent().append(editIconHTML);var responsePayLoadDocsContainer=jQuery("[data-role='response-payload-docs']");responsePayLoadDocsContainer.wrap("<div class='clearfix'></div>");responsePayLoadDocsContainer.attr("data-allow-edit","true");responsePayLoadDocsContainer.parent().append('<textarea class="response_payload_doc_edit"></textarea>'+editIconHTML);Apigee.APIModel.inlineEditPageEvents()};this.handleEditPropertiesMouseOver=function(){var dataRole=jQuery(this).attr("data-role");if(!jQuery(this).hasClass("editing")){jQuery(this).addClass("edit");jQuery(this).siblings("a.allow_edit.hover").css({display:"inline-block"})}};this.handleEditPropertiesMouseOut=function(){var dataRole=jQuery(this).attr("data-role");if(!jQuery(this).hasClass("editing")){jQuery(this).removeClass("edit");jQuery(this).siblings("a.allow_edit.hover").hide()}};this.handleEditableElementsClick=function(e){var dateRoleFlag=false;if(currentEdiatableElement){if(jQuery(this).attr("data-role")=="description"&&!currentEdiatableElement.is(jQuery(this))){dateRoleFlag=true}else{dateRoleFlag=currentEdiatableElement.attr("data-role")!=jQuery(this).attr("data-role")}}jQuery("[data-role='error_container']").hide().html("");if(currentEdiatableElementValue!=""&&editingFlag&&currentEdiatableElement!=null&&dateRoleFlag){var previsionEditableElementValue=jQuery.trim(currentEdiatableElement.text());if(currentEdiatableElement.siblings("textarea").length){previsionEditableElementValue=jQuery.trim(currentEdiatableElement.siblings("textarea").val())}if(currentEdiatableElementValue!=previsionEditableElementValue){jQuery("[data-role='confirm_modal']").modal("show");Apigee.APIModel.initInlineEditAdminAuthEvents()}else if(!currentEdiatableElement.is(jQuery(this))){self.resetEditableElement()}}else{currentEdiatableElement=jQuery(this);if(!descriptionEditFlag&&jQuery(this).attr("data-role")=="description"){currentEdiatableElement.text(currentEdiatableElement.html());descriptionEditFlag=true}currentEdiatableElementValue=jQuery.trim(jQuery(this).text());if(jQuery(this).hasClass("resource_description")||jQuery(this).attr("data-role")=="request-payload-docs"||jQuery(this).attr("data-role")=="response-payload-docs"){currentEdiatableElementValue=jQuery.trim(jQuery(this).html());jQuery(this).hide();jQuery(this).siblings("textarea").val(jQuery.trim(jQuery(this).html())).height(jQuery(this).height()+30).show();jQuery(this).siblings("textarea").focus();jQuery(this).siblings("textarea").unbind("click").click(function(){return false});Apigee.APIModel.initInlineEditAdminAuthEvents()}if(jQuery(this).attr("data-role")=="method-title"||jQuery(this).attr("data-role")=="description"){jQuery(this).attr("contenteditable","true")}else{jQuery("[data-role='method-title']").removeAttr("contenteditable")}jQuery(this).addClass("editing");jQuery(this).siblings("a.allow_edit.hover").hide();jQuery(this).siblings("a.allow_edit.ok").show();jQuery(this).siblings("a.allow_edit.cancel").show();jQuery(this).addClass("edit");editingFlag=true;jQuery(this).focus()}e.preventDefault();return false};this.resetEditableElement=function(){descriptionEditFlag=false;editingFlag=false;currentEdiatableElement.removeClass("editing");currentEdiatableElement.siblings("a.allow_edit").hide();currentEdiatableElement.html(currentEdiatableElementValue);if(currentEdiatableElement.attr("data-role")=="description"){currentEdiatableElement.html(currentEdiatableElementValue)}if(currentEdiatableElement.attr("data-role")=="method-description"){jQuery("textarea.resource_description_edit").val(currentEdiatableElementValue)}currentEdiatableElement.removeClass("edit").removeClass("editing");if(currentEdiatableElement.hasClass("resource_description")||currentEdiatableElement.attr("data-role")=="request-payload-docs"||currentEdiatableElement.attr("data-role")=="response-payload-docs"){currentEdiatableElement.siblings("textarea").hide();currentEdiatableElement.show()}currentEdiatableElementValue="";return false};this.documentClickHandler=function(){descriptionEditFlag=false;if(currentEdiatableElement){currentEdiatableElement.removeClass("editing")}if(currentEdiatableElementValue!=""&&jQuery("body").children("[role='dialog'].modal").is(":visible")==false){jQuery("[data-role='confirm_modal']").modal("show");Apigee.APIModel.initInlineEditAdminAuthEvents()}};this.handleConfirmDialogSave=function(){descriptionEditFlag=false;currentEdiatableElement.siblings("a.allow_edit.ok").trigger("click");self.closeAuthModal();Apigee.APIModel.initInlineEditAdminAuthEvents();currentEdiatableElementValue="";return false};this.makeAPICall=function(e){var operationPath=location.href;editingFlag=false;currentEdiatableElement.removeClass("editing");var jsonBody="";if(currentEdiatableElement.attr("data-role")=="description"&&currentEdiatableElement.parent().parent().attr("data-scope")=="resource"){lastEditScope="resource";operationPath=operationPath.split("/methods/")[0];if(typeof Drupal!="undefined"&&typeof Drupal.settings!="undefined"){operationPath=Drupal.settings.smartdocs.apiModelBaseUrl+"/v1/o/"+Apigee.APIModel.organizationName+"/apimodels/"+Apigee.APIModel.apiName+"/revisions/"+Apigee.APIModel.revisionNumber+"/resources/"+Apigee.APIModel.resourceId}if(Apigee.APIModel.apiModelBaseUrl){operationPath=Apigee.APIModel.apiModelBaseUrl+"/v1/o/"+Apigee.APIModel.organizationName+"/apimodels/"+Apigee.APIModel.apiName+"/revisions/"+Apigee.APIModel.revisionNumber+"/resources/"+Apigee.APIModel.resourceId}jsonBody+='{"parameters": ['+constructParams("general","resource")+" ]";jsonBody+=', "parameterGroups": [ '+constructParamGroups("resource")+" ]}"}else{lastEditScope="method";operationPath=operationPath.split("/doc?")[0];if(typeof Drupal!="undefined"&&typeof Drupal.settings!="undefined"){operationPath=Drupal.settings.smartdocs.apiModelBaseUrl+"/v1/o/"+Apigee.APIModel.organizationName+"/apimodels/"+Apigee.APIModel.apiName+"/revisions/"+Apigee.APIModel.revisionNumber+"/resources/"+Apigee.APIModel.resourceId+"/methods/"+Apigee.APIModel.methodId}if(Apigee.APIModel.apiModelBaseUrl){operationPath=Apigee.APIModel.apiModelBaseUrl+"/v1/o/"+Apigee.APIModel.organizationName+"/apimodels/"+Apigee.APIModel.apiName+"/revisions/"+Apigee.APIModel.revisionNumber+"/resources/"+Apigee.APIModel.resourceId+"/methods/"+Apigee.APIModel.methodId}var descriptionText=jQuery.trim(jQuery("textarea.resource_description_edit").val());if(currentEdiatableElement.attr("data-role")!="method-description"){descriptionText=jQuery.trim(jQuery(".resource_description ").html())}var authenticationValue=jQuery("[data-role='auth-type']").text();authenticationValue=authenticationValue.replace("Basic Auth","BASICAUTH").replace("Custom Token","CUSTOM").replace("OAuth 1","OAUTH1WEBSERVER").replace("OAuth 1 Client Credentials","OAUTH1CLIENTCREDENTIALS").replace("OAuth 2","OAUTH2WEBSERVER").replace("OAuth 2 Client Credentials","OAUTH2CLIENTCREDENTIALS").replace("OAuth 2 Implicit Grant Flow","OAUTH2IMPLICITGRANT").replace("No auth","NOAUTH");var authtenticationString="";if(authenticationValue.split(",").length>1){authtenticationString="[";for(var i=0;i<authenticationValue.split(",").length;i++){authtenticationString+='"'+authenticationValue.split(",")[i]+'"';if(i!=authenticationValue.split(",").length-1){authtenticationString+=","}}authtenticationString+="]"}else{authtenticationString='[ "'+authenticationValue+'" ]'}var categoriesValue=jQuery.trim(jQuery("[data-role='category']").text());var categoriesString="";if(categoriesString.split(",").length>1){categoriesString="[";for(var i=0;i<categoriesValue.split(",").length;i++){categoriesString+='"'+categoriesValue.split(",")[i]+'"';if(i!=categoriesValue.split(",").length-1){categoriesString+=","}}categoriesString+="]"}else{categoriesString='[ "'+categoriesValue+'" ]'}descriptionText=JSON.stringify(descriptionText);descriptionText=descriptionText.substring(1,descriptionText.length-1);descriptionText=self.escapeSpecialChars(descriptionText);jsonBody='{ "displayName":"'+jQuery.trim(jQuery("[data-role='method-title']").html())+'", "description": "'+descriptionText+'","verb": "'+jQuery.trim(jQuery("[data-role='verb']").text())+'",';jsonBody+='"authSchemes" : '+authtenticationString+', "tags" : '+categoriesString;var contentTypeValue="";if(jQuery.trim(jQuery("[data-role='content-type']").text())!="N.A."){contentTypeValue=jQuery.trim(jQuery("[data-role='content-type']").text())}var paramString=constructParams("general");if(paramString.length){if(paramString.charAt(paramString.length-1)===","){paramString=paramString.substring(0,paramString.length-1)}jsonBody+=', "parameters": ['+paramString+" ]"}jsonBody+=', "parameterGroups": [ '+constructParamGroups("method")+" ]";jsonBody+=', "body": {';jsonBody+='"parameters": [';jsonBody+=constructParams("body");jsonBody+=" ]";jsonBody+=', "attachments": [';jsonBody+=constructParams("attachments");jsonBody+=" ]";jsonBody+=', "contentType":"'+contentTypeValue+'"';if(jQuery('[data-role="request-payload-example"]').length){var requestPayload=JSON.stringify(window.apiModelEditor.getRequestPayLoad());requestPayload=requestPayload.substring(1,requestPayload.length-1);requestPayload=self.escapeSpecialChars(requestPayload);jsonBody+=', "sample" :"'+requestPayload+'"'}var requestPayloadDocElement=jQuery("[data-role='request-payload-docs']");var responsePayloadDocElement=jQuery("[data-role='response-payload-docs']");var requestPayloadDocValue="";var responsePayloadDocValue="";if(requestPayloadDocElement.length){var requestPayloadDocValue=jQuery.trim(requestPayloadDocElement.html());if(requestPayloadDocElement.siblings("textarea").is(":visible")==true){requestPayloadDocValue=jQuery.trim(requestPayloadDocElement.siblings("textarea").val())}requestPayloadDocValue=JSON.stringify(requestPayloadDocValue);requestPayloadDocValue=requestPayloadDocValue.substring(1,requestPayloadDocValue.length-1);requestPayloadDocValue=self.escapeSpecialChars(requestPayloadDocValue);requestPayloadDocValue=', "doc": "'+requestPayloadDocValue+'" ';jsonBody+=requestPayloadDocValue}jsonBody+=" }";var reponseErrorsElement=jQuery("[data-role='response_errors_list']");if(responsePayloadDocElement.length||reponseErrorsElement.length){jsonBody+=', "response": {';if(responsePayloadDocElement.length){var responsePayloadDocValue=jQuery.trim(responsePayloadDocElement.html());if(responsePayloadDocElement.siblings("textarea").is(":visible")==true){responsePayloadDocValue=jQuery.trim(responsePayloadDocElement.siblings("textarea").val())}responsePayloadDocValue=JSON.stringify(responsePayloadDocValue);responsePayloadDocValue=responsePayloadDocValue.substring(1,responsePayloadDocValue.length-1);responsePayloadDocValue=self.escapeSpecialChars(responsePayloadDocValue);var responsePayload=JSON.stringify(jQuery("[data-role='response-payload']").val());responsePayload=responsePayload.substring(1,responsePayload.length-1);responsePayload=self.escapeSpecialChars(responsePayload);jsonBody+='"doc": "'+responsePayloadDocValue+'"  ,"sample" : "'+responsePayload+'", "contentType" : "'+jQuery("[data-role='response-content-type']").text()+'"'}if(reponseErrorsElement.length){var paramString="";jQuery(reponseErrorsElement).each(function(index){var currentElement=jQuery(this);paramString+='{"httpStatusCode" :"'+jQuery.trim(currentElement.find("[data-role='http_status_code']").html())+'",';paramString+='"code" : "'+jQuery.trim(currentElement.find("[data-role='code']").html())+'",';paramString+='"description" :"'+jQuery.trim(currentElement.find("[data-role='description']").html())+'"}';var noOfParam=jQuery(reponseErrorsElement).length;if(noOfParam>index+1){paramString+=","}});if(responsePayloadDocElement.length){jsonBody+=","}jsonBody+='"errors" : ['+paramString+"]"}jsonBody+="}"}jsonBody+="}"}var headersList=[];if(localStorage.orgAdminBasicAuthDetails){if(basicAuth!=localStorage.orgAdminBasicAuthDetails.split("@@@")[0]){basicAuth=localStorage.orgAdminBasicAuthDetails.split("@@@")[0];jQuery(".admin_auth_section a.auth_admin_email").html(localStorage.orgAdminBasicAuthDetails.split("@@@")[1])}}headersList.push({name:"Authorization",value:basicAuth});headersList.push({name:"Content-Type",value:"application/json"});jQuery("#working_alert").fadeIn();operationPath=Apigee.APIModel.proxyURL+"?targeturl="+operationPath;self.makeAJAXCall({url:operationPath,type:"put",dataType:"json",headers:headersList,data:jsonBody,callback:self.handleAPICallSuccess,errorCallback:self.handleUpdateFailure});jQuery(this).siblings("[contenteditable='true']").removeClass("edit");jQuery(this).siblings("a.allow_edit.cancel").hide();jQuery(this).siblings("a.allow_edit.ok").hide();if(jQuery(this).siblings("textarea").is(":visible")){jQuery(this).siblings("textarea").hide();jQuery(this).siblings("[data-allow-edit='true']").html(jQuery(this).siblings("textarea").val()).removeClass("edit").removeClass("editing").show()}jQuery(this).hide();e.stopPropagation();return false};this.handleAPICallSuccess=function(data){descriptionEditFlag=false;data=unescape(data.responseContent);data=JSON.parse(data);currentEdiatableElementValue=jQuery.trim(currentEdiatableElement.html());jQuery("[data-role='method-title']").html(data.displayName);jQuery("[data-role='method-description']").html(data.description);jQuery("[data-role='query-param-list'], [data-role='header-param-list'], [data-role='body-param-list'], [data-role='response_errors_list'], [data-role='attachments-list']").each(function(index){updateParms(jQuery(this),data)});if(typeof Drupal!="undefined"&&typeof Drupal.settings!="undefined"){var windowURL=window.location.href;var drupalURL=windowURL=windowURL.replace("?editMode=1","?flush=1").replace("?editMode=2","?flush=1");self.makeAJAXCall({url:drupalURL,callback:self.drupalUpdateSuccess})}currentEdiatableElementValue=""};this.drupalUpdateSuccess=function(){};this.handleUpdateFailure=function(){self.resetEditableElement();self.showError("Error saving changes.")}};Apigee.APIModel.InlineEdit.prototype=new Apigee.APIModel.Common;